    <!--
       ========================================================================
         Start WebLogic 7.0
       ========================================================================
    -->
    <target name="start.weblogic.70" depends="checkwindows, windows.start.weblogic.70, other.start.weblogic.70"/>
    
    <target name="windows.start.weblogic.70" if="isWindows">
        <property name="target.weblogic70.dir"
            value="${target.test.dir}/weblogic70"/>
        <java jvm='javaw' classname="weblogic.Server" fork="yes"
            dir="${target.weblogic70.dir}/testdomain">

            <classpath>
                <pathelement location="${home.weblogic.70}/weblogic700/server/lib/weblogic.sp.jar"/>
                <pathelement location="${home.weblogic.70}/weblogic700/server/lib/weblogic.jar"/>
            </classpath>

            <jvmarg value="-hotspot"/>
            <jvmarg value="-ms64m"/>
            <jvmarg value="-mx64m"/>
            <jvmarg value="-Djava.library.path=${java.library.path};${home.weblogic.70}/weblogic700/server/bin"/>
            <jvmarg value="-Dweblogic.Name=testserver"/>
            <jvmarg value="-Dbea.home=${home.weblogic.70}"/>
            <jvmarg value="-Dweblogic.management.username=system"/>
            <jvmarg value="-Dweblogic.management.password=password"/>
            <jvmarg value="-Djava.security.policy==./server/lib/weblogic.policy"/>

        </java>

    </target>

    <target name="other.start.weblogic.70" unless="isWindows">
        <property name="target.weblogic70.dir"
            value="${target.test.dir}/weblogic70"/>
        <java classname="weblogic.Server" fork="yes"
            dir="${target.weblogic70.dir}/testdomain">

            <classpath>
                <pathelement location="${home.weblogic.70}/weblogic700/server/lib/weblogic.sp.jar"/>
                <pathelement location="${home.weblogic.70}/weblogic700/server/lib/weblogic.jar"/>
            </classpath>

            <jvmarg value="-hotspot"/>
            <jvmarg value="-ms64m"/>
            <jvmarg value="-mx64m"/>
            <jvmarg value="-Djava.library.path=${java.library.path};${home.weblogic.70}/weblogic700/server/bin"/>
            <jvmarg value="-Dweblogic.Name=testserver"/>
            <jvmarg value="-Dbea.home=${home.weblogic.70}"/>
            <jvmarg value="-Dweblogic.management.username=system"/>
            <jvmarg value="-Dweblogic.management.password=password"/>
            <jvmarg value="-Djava.security.policy==./server/lib/weblogic.policy"/>

        </java>

    </target>

    <!--
       ========================================================================
         Stop WebLogic 7.0
       ========================================================================
    -->
    <target name="stop.weblogic.70" depends="checkwindows, windows.stop.weblogic.70, other.stop.weblogic.70"/>
    
    <target name="windows.stop.weblogic.70" if="isWindows">

        <java jvm='javaw' classname="weblogic.Admin" fork="yes">

            <classpath>
                <pathelement location="${home.weblogic.70}/weblogic700/server/lib/weblogic.sp.jar"/>
                <pathelement location="${home.weblogic.70}/weblogic700/server/lib/weblogic.jar"/>
            </classpath>

            <arg line="-url t3://localhost:${test.port}"/>
            <arg line="-username system"/>
            <arg line="-password password"/>
            <arg value="SHUTDOWN"/>

        </java>

    </target>

    <target name="other.stop.weblogic.70" unless="isWindows">

        <java classname="weblogic.Admin" fork="yes">

            <classpath>
                <pathelement location="${home.weblogic.70}/weblogic700/server/lib/weblogic.sp.jar"/>
                <pathelement location="${home.weblogic.70}/weblogic700/server/lib/weblogic.jar"/>
            </classpath>

            <arg line="-url t3://localhost:${test.port}"/>
            <arg line="-username system"/>
            <arg line="-password password"/>
            <arg value="SHUTDOWN"/>

        </java>

    </target>


    <!--
       ========================================================================
         Prepare directories and variables for running the tests
       ========================================================================
    -->
    <target name="prepare.weblogic.70"
        depends="check.test.weblogic.70" if="home.weblogic.70">

        <echo message="home.weblogic.70 = ${home.weblogic.70}"/>

        <property name="target.weblogic70.dir"
            value="${target.test.dir}/weblogic70"/>
        <property name="conf.weblogic70.dir"
            value="${conf.test.dir}/weblogic70"/>

        <mkdir dir="${target.weblogic70.dir}/testdomain/applications"/>
        <mkdir dir="${target.weblogic70.dir}/testdomain/testserver"/>

        <!-- Copy WL 7.0 configuration files -->
        <copy file="${conf.weblogic70.dir}/config.xml"
            todir="${target.weblogic70.dir}/testdomain" filtering="on"/>
        <copy file="${conf.weblogic70.dir}/fileRealm.properties"
            todir="${target.weblogic70.dir}/testdomain"/>
        <copy file="${conf.weblogic70.dir}/SerializedSystemIni.dat"
            todir="${target.weblogic70.dir}/testdomain"/>
        <copy file="${conf.weblogic70.dir}/DefaultAuthenticatorInit.ldift"
            todir="${target.weblogic70.dir}/testdomain"/>

        <!-- Copy security configuration files -->
        <copy todir="${target.weblogic70.dir}/testdomain/testserver">
            <fileset dir="${conf.weblogic70.dir}/testserver"/>
        </copy>

        <!-- Copy the war file -->
        <copy file="${war.path}"
            tofile="${target.weblogic70.dir}/testdomain/applications/${context.path}.war"/>

        <!-- Update the war to include the proprietary weblogic.xml config
             file. -->

        <!-- Hack: Make sure weblogic.xml is always newer than the war so that
             the later is always updated. Waiting for an Ant bug fix -->
        <touch file="${target.weblogic70.dir}/testdomain/applications/${context.path}.war"
            datetime="06/28/2000 2:02 pm"/>

        <war update="true"
            warfile="${target.weblogic70.dir}/testdomain/applications/${context.path}.war">

            <webinf dir="${conf.weblogic70.dir}">
                <include name="weblogic.xml"/>
            </webinf>
        </war>

    </target>
