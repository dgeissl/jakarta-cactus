<?xml version="1.0"?>

<document id="integration_jetty">

  <properties>
    <title>Jetty Integration</title>
    <authors>
      <author name="Julien Ruaux" email="jruaux@octo.com"/>
      <author name="Vincent Massol" email="vmassol@apache.org"/>
    </authors>
  </properties>

  <body>

    <section title="Forewords and Requirements">

      <p>
        This page explains how to run Cactus tests with the Jetty servlet
        container. You will need the single <link href="ext:jetty">Jetty</link>
        jar, and if you are using JSPs you will also need the Jasper jars.
      </p>

    </section>
    
    <section title="Setting up Jetty">

      <p>
        The idea is to use the 
        <code>org.apache.cactus.extension.jetty.JettyTestSetup</code> JUnit
        TestSetup class provided by Cactus so that Jetty is started before the 
        tests are run.
      </p>
      
      <p>
        In order to use the TestSetup, you need to wrap your test suite in 
        <code>JettyTestSetup</code>:
      </p>
<source><![CDATA[
public class TestJettyAll extends TestCase
{
    public static Test suite()
    {
        TestSuite suite = new TestSuite();
        suite.addTestSuite(MyTestClass1.class);
        [...]
        suite.addTestSuite(MyTestClassN.class);
        
        return new JettyTestSetup(suite);
    }        
]]></source>
      
      <p>
        You can also define some System properties (they are optional) to 
        control the Jetty TestSetup behavior:
      </p>      
      <ul>
        <li>
          <code>cactus.jetty.config</code> (optional), value :
          location of a jetty.xml file (see Jetty's documentation
          for details)
        </li>
        <li>
          <code>cactus.jetty.resourceDir</code> (optional), value :
          location of a webapp directory (expanded war)
        </li>
      </ul>

      <note>
        If you're using JSPs you'll need to add the Jasper jars to your 
        runtime Classpath (in addition to the Jetty jar).
      </note>      

      <section title="Case 1: running from Ant">
	
        <p>
          Let's assume we have a JUnit task that launches the tests.
          We need to add the Jetty jar and optionally the Jasper jars
          (if we use JSPs) to the runtime classpath. Then, all we have 
          to do is add the correct VM arguments to configure
          the <code>JettyTestSetup</code> behavior. For example:
        </p>
<source><![CDATA[
<junit>

    [...]
    
    <jvmarg value="-Dcactus.contextURL=http://localhost:${test.port}/test"/>
    <jvmarg value="-Dcactus.jetty.resourceDir=${src.webapp.dir}"/>
    <jvmarg value="-Dcactus.jetty.config=${src.webapp.dir}/test/jetty.xml"/>

    <classpath>
        [...]
        <!-- Include Jetty jar and optionally Jasper jars in the classpath -->
        <pathelement location="${jetty.jar}"/>
        <pathelement location="${jasper-compiler.jar}"/>
        <pathelement location="${jasper-runtime.jar}"/>    
    </classpath>
    
    <test name="org.apache.cactus.sample.TestJettyAll"/>

</junit>
]]></source>
	    
      </section>
	    
      <section title="Case 2: running from an IDE">
		
        <p>
          Again all you have to do is add the correct VM arguments, and the
          Jetty and Jasper jars, to the JUnit launch.
        </p>
		    
        <p>
          For example in Eclipse you would add the jars, and create a JUnit
          launch configuration as below:
        </p>
        <figure src="images/jetty_eclipse.png"
          alt="Eclipse configuration for Jetty"/>          
		
      </section>

    </section>
  </body>
</document>
