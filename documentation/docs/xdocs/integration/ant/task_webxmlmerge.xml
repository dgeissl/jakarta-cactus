<?xml version="1.0"?>

<document id="task_webxmlmerge">

  <properties>
    <title>WebXmlMerge Ant Task</title>
    <authors>
      <author name="Christopher Lenz" email="cmlenz@apache.org"/>
    </authors>
  </properties>

  <body>

  <section title="WebXmlMerge Task">

    <p>
      The task <strong>&lt;webxmlmerge&gt;</strong> provides a convenient way 
      to inject external definitions into a web deployment descriptor
      (<code>web.xml</code>) from an Ant build. It's primary intended use is to
      include the definition of the Cactus redirectors into the application's
      descriptor to enable testing the application with Cactus.
    </p>

    <section title="Parameters">

      <table>
        <tr>
          <th>Name</th>
          <th>Description</th>
          <th>Required</th>
        </tr>
        <tr>
          <td>srcfile</td>
          <td>
            The original deployment descriptor.
          </td>
          <td>Yes</td>
        </tr>
        <tr>
          <td>destfile</td>
          <td>
            The destination file.
          </td>
          <td>Yes</td>
        </tr>
        <tr>
          <td>mergefile</td>
          <td>
            The descriptor containing the definitions that should be merged
            into the descriptor.
          </td>
          <td>Yes</td>
        </tr>
        <tr>
          <td>encoding</td>
          <td>
            The character encoding of the destination file. If this attribute is
            ommitted, the character encoding of the source file will be applied.
          </td>
          <td>No</td>
        </tr>
        <tr>
          <td>force</td>
          <td>
            By default the task checks the modification times of the files before
            performing the merge. Set this attribute to <em>false</em> to perform
            the merge regardless of whether the destination file seems to be up
            to date.
          </td>
          <td>No</td>
        </tr>
        <tr>
          <td>indent</td>
          <td>
            Whether the resulting XML should be indented when written to the
            destination file.
          </td>
          <td>No, the default is <em>false</em></td>
        </tr>
      </table>

    </section>

    <section title="Nested Elements">

      <section title="xmlcatalog">

        <p>
          The <em>xmlcatalog</em> element can be used to perform Entity and URI
          resolution. This is a built-in Ant type. See the Ant documentation for
          details.
        </p>

      </section>

    </section>

    <section title="Examples">

      <p>
        The following example demonstrates the simplest-possible use of the
        task.
      </p>

      <source><![CDATA[
<webxmlmerge srcfile="${src.conf.dir}/web.xml"
    destfile="${build.conf.dir}/web.xml"
    mergefile="${cactus.ant.home}/confs/web.xml"/>
]]></source>

      <p>
        To improve speed of the parsing process and enable offline operation,
        you should specify local paths to the web-app DTDs using a nested
        <em>xmlcatalog</em> element:
      </p>

      <source><![CDATA[
<webxmlmerge srcfile="${src.conf.dir}/web.xml"
    destfile="${build.conf.dir}/web.xml"
    mergefile="${cactus.ant.home}/confs/web.xml">
  <xmlcatalog>
    <dtd publicid="-//Sun Microsystems, Inc.//DTD Web Application 2.2//EN"
        location="${src.dtd.dir}/web-app_2_2.dtd"/>
    <dtd publicid="-//Sun Microsystems, Inc.//DTD Web Application 2.3//EN"
        location="${src.dtd.dir}/web-app_2_3.dtd"/>
  </xmlcatalog>
</webxmlmerge>
]]></source>

      <p>
        The following example demonstrates using an <em>xmlcatalog</em>
        by reference, so that it can also be used in other tasks (for 
        example to validate the descriptors). In addition, the
        <em>indent</em> attribute is set to <em>yes</em> to achieve better
        readability of the resulting descriptor.
      </p>

      <source><![CDATA[
<xmlcatalog id="j2ee.dtds">
  <dtd publicid="-//Sun Microsystems, Inc.//DTD Web Application 2.2//EN"
      location="${src.dtd.dir}/web-app_2_2.dtd"/>
  <dtd publicid="-//Sun Microsystems, Inc.//DTD Web Application 2.3//EN"
      location="${src.dtd.dir}/web-app_2_3.dtd"/>
</xmlcatalog>

<webxmlmerge srcfile="${src.conf.dir}/web.xml"
    destfile="${build.conf.dir}/web.xml"
    mergefile="${cactus.ant.home}/confs/web.xml"
    indent="yes">
  <xmlcatalog refid="j2ee.dtds"/>
</webxmlmerge>
]]></source>

    </section>

  </section>

  </body>
</document>
