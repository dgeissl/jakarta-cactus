<?xml version="1.0"?>

<document id="task_webxmlmerge">

  <properties>
    <title>Cactus Ant Task</title>
    <authors>
      <author name="Christopher Lenz" email="cmlenz@apache.org"/>
    </authors>
  </properties>

  <body>

  <section title="Cactus Task">

    <p>
      The task <strong>cactus</strong> is an extension of the
      <strong>junit</strong> task that is included in Ant as an optional task.
      <strong>cactus</strong> extends <strong>junit</strong> to enable
      in-container tests. It features built-in support for a variety of
      containers, but also allows testing in custom containers.
    </p>

    <p>
      Currently the following containers are supported out of the box:
      <ul>
        <li>Apache Tomcat 3.x</li>
        <li>Apache Tomcat 4.x</li>
        <li>Apache Tomcat 5.x</li>
        <li>JBoss Application Server 3.x</li>
        <li>Orion Application Server 1.x</li>
        <li>Orion Application Server 2.x</li>
        <li>Resin Server 2.x</li>
        <li>Bea WebLogic Server 7.x</li>
      </ul>
    </p>

    <section title="Parameters">

      <note>
        As this task is an extension of the <strong>junit</strong> task, it
        also supports all attributes that the <strong>junit</strong> task
        supports.
      </note>

      <table>
        <tr>
          <th>Name</th>
          <th>Description</th>
          <th>Required</th>
        </tr>
        <tr>
          <td><strong>warfile</strong></td>
          <td>
            The web-application archive that should be tested.
          </td>
          <td>Yes</td>
        </tr>
      </table>

    </section>

    <section title="Nested Elements">

      <note>
        As this task is an extension of the <strong>junit</strong> task, it
        also supports all the nested elements supported by the
        <strong>junit</strong> task.
      </note>

      <section title="containerset">

        <p>
          The <strong>containerset</strong> element lets you specify which
          containers the tests should run against. Every element nested inside
          this element corresponds to a container. See below for a list of 
          container elements supported in this element.
        </p>

        <section title="Parameters">

          <note>
            The <strong>containerset</strong> element supports the following
            parameters:
          </note>

          <table>
            <tr>
              <th>Name</th>
              <th>Description</th>
              <th>Required</th>
            </tr>
            <tr>
              <td>timeout</td>
              <td>
                Specifies the timeout in milliseconds after which starting up
                a container should be given up. If the timeout is reached
                before the container starts responding with a successful HTTP
                status code, the build will fail.
              </td>
              <td>No, default is <em>3 minutes</em></td>
            </tr>
            <tr>
              <td>proxyport</td>
              <td>
                By specifying this attribute it is possible to insert some
                application that acts as a local TCP/IP proxy between the
                test runner and the actual containers. Most importantly, that
                includes applications that record and display the HTTP
                transactions, which can be helpful in tracking down tricky 
                problems.
              </td>
              <td>No</td>
            </tr>
          </table>

        </section>

      </section>

    </section>

    <section title="Supported Containers">

      <p>
        All elements nested in the <strong>containerset</strong> element
        represent specific containers. As all these container element derive
        from a common base, there are a couple of attribute and nested elements
        that apply to all.
      </p>

      <section title="Parameters">

        <p>
          Every container element supports the following parameters:
        </p>

        <table>
          <tr>
            <th>Name</th>
            <th>Description</th>
            <th>Required</th>
          </tr>
          <tr>
            <td>if</td>
            <td>
              Tests will only be run in the container if a property of the
              given name exists in the current project
            </td>
            <td>No</td>
          </tr>
          <tr>
            <td>unless</td>
            <td>
              Tests will only be run in the container if a property of the
              given name doesn't exist in the current project
            </td>
            <td>No</td>
          </tr>
        </table>

      </section>

      <section title="Nested Elements">

        <p>
          Every container supports the following nested elements:
        </p>

        <section title="exclude">

          <p>
            Multiple <strong>exclude</strong> elements can be used as in
            standard Ant PatternSets or FileSets to exclude specific tests
            from running in the container.
          </p>

        </section>

      </section>

      <p>
        Specific container elements provide more attributes and nested elements
        as appropriate.
      </p>

      <section title="generic">

        <p>
          The <strong>generic</strong> container supports custom containers by
          allowing you to specify targets to be called, or tasks to executed,
          in order to start up and shut down the container.
        </p>

        <section title="Parameters">

          <table>
            <tr>
              <th>Name</th>
              <th>Description</th>
              <th>Required</th>
            </tr>
            <tr>
              <td>port</td>
              <td>
                The TCP port that the container should listen to
              </td>
              <td>No, default is 8080</td>
            </tr>
          </table>

        </section>

        <section title="Nested Elements">

          <p>
            The <strong>generic</strong> container supports the following nested
            elements:
          </p>

          <section title="startup">

            <p>
              A single <strong>startup</strong> element can be nested inside a 
              <strong>generic</strong> element. Using this element, you can
              implement the startup of the container, either by specifying a 
              target name in the <strong>target</strong> attribute, or by
              directly embedding the required Ant tasks inside the
              <strong>startup</strong> element.
            </p>

          </section>

          <section title="shutdown">

            <p>
              A single <strong>shutdown</strong> element can be nested inside a 
              <strong>generic</strong> element. Using this element, you can
              implement the shutdown of the container, either by specifying a 
              target name in the <strong>target</strong> attribute, or by
              directly embedding the required Ant tasks inside the
              <strong>shutdown</strong> element.
            </p>

          </section>

        </section>

      </section>

      <section title="jboss3x">

        <p>
          The nested element <strong>orion1x</strong> allows running the tests
          against the JBoss 3.x application server.
        </p>

        <section title="Parameters">

          <table>
            <tr>
              <th>Name</th>
              <th>Description</th>
              <th>Required</th>
            </tr>
            <tr>
              <td><strong>dir</strong></td>
              <td>
                The installation directory of the JBoss 3.x server
              </td>
              <td>Yes</td>
            </tr>
            <tr>
              <td>config</td>
              <td>
                The name of the configuration to use
              </td>
              <td>No, the default is <em>default</em></td>
            </tr>
            <tr>
              <td>output</td>
              <td>
                Name of a file to write the output of the container to. If not
                specified, the standard output will be used
              </td>
              <td>No</td>
            </tr>
            <tr>
              <td>append</td>
              <td>
                Whether output should be appended to or overwrite an existing
                file.
              </td>
              <td>No, default is <em>false</em></td>
            </tr>
          </table>

        </section>

      </section>

      <section title="orion1x">

        <p>
          The nested element <strong>orion1x</strong> allows running the tests
          against the Orion Application Server 1.x.
        </p>

        <section title="Parameters">

          <table>
            <tr>
              <th>Name</th>
              <th>Description</th>
              <th>Required</th>
            </tr>
            <tr>
              <td><strong>dir</strong></td>
              <td>
                The installation directory of the Orion 1.x server
              </td>
              <td>Yes</td>
            </tr>
            <tr>
              <td>port</td>
              <td>
                The TCP port that the container should listen to
              </td>
              <td>No, default is 8080</td>
            </tr>
            <tr>
              <td>output</td>
              <td>
                Name of a file to write the output of the container to. If not
                specified, the standard output will be used
              </td>
              <td>No</td>
            </tr>
            <tr>
              <td>append</td>
              <td>
                Whether output should be appended to or overwrite an existing
                file.
              </td>
              <td>No, default is <em>false</em></td>
            </tr>
          </table>

        </section>

      </section>

      <section title="orion2x">

        <p>
          The nested element <strong>orion1x</strong> allows running the tests
          against the Orion Application Server 2.x.
        </p>

        <section title="Parameters">

          <table>
            <tr>
              <th>Name</th>
              <th>Description</th>
              <th>Required</th>
            </tr>
            <tr>
              <td><strong>dir</strong></td>
              <td>
                The installation directory of the Orion 2.x server
              </td>
              <td>Yes</td>
            </tr>
            <tr>
              <td>port</td>
              <td>
                The TCP port that the container should listen to
              </td>
              <td>No, default is 8080</td>
            </tr>
            <tr>
              <td>output</td>
              <td>
                Name of a file to write the output of the container to. If not
                specified, the standard output will be used
              </td>
              <td>No</td>
            </tr>
            <tr>
              <td>append</td>
              <td>
                Whether output should be appended to or overwrite an existing
                file.
              </td>
              <td>No, default is <em>false</em></td>
            </tr>
          </table>

        </section>

      </section>

      <section title="resin2x">

        <p>
          The nested element <strong>orion1x</strong> allows running the tests
          against the Resin Server 2.x.
        </p>

        <section title="Parameters">

          <table>
            <tr>
              <th>Name</th>
              <th>Description</th>
              <th>Required</th>
            </tr>
            <tr>
              <td><strong>dir</strong></td>
              <td>
                The installation directory of the Resin 2.x server
              </td>
              <td>Yes</td>
            </tr>
            <tr>
              <td>resinconf</td>
              <td>
                The configuration file to use instead of the default one
              </td>
              <td>No</td>
            </tr>
            <tr>
              <td>port</td>
              <td>
                The TCP port that the container should listen to
              </td>
              <td>No, default is 8080</td>
            </tr>
            <tr>
              <td>output</td>
              <td>
                Name of a file to write the output of the container to. If not
                specified, the standard output will be used
              </td>
              <td>No</td>
            </tr>
            <tr>
              <td>append</td>
              <td>
                Whether output should be appended to or overwrite an existing
                file.
              </td>
              <td>No, default is <em>false</em></td>
            </tr>
          </table>

        </section>

      </section>

      <section title="tomcat3x">

        <p>
          The nested element <strong>tomcat3x</strong> allows running the tests
          against the Apache Tomcat 3.x servlet container.
        </p>

        <section title="Parameters">

          <table>
            <tr>
              <th>Name</th>
              <th>Description</th>
              <th>Required</th>
            </tr>
            <tr>
              <td><strong>dir</strong></td>
              <td>
                The installation directory of the Tomcat 3.x server
              </td>
              <td>Yes</td>
            </tr>
            <tr>
              <td>serverxml</td>
              <td>
                The server configuration file to use instead of the default one
              </td>
              <td>No</td>
            </tr>
            <tr>
              <td>port</td>
              <td>
                The TCP port that the container should listen to
              </td>
              <td>No, default is 8080</td>
            </tr>
            <tr>
              <td>output</td>
              <td>
                Name of a file to write the output of the container to. If not
                specified, the standard output will be used
              </td>
              <td>No</td>
            </tr>
            <tr>
              <td>append</td>
              <td>
                Whether output should be appended to or overwrite an existing
                file.
              </td>
              <td>No, default is <em>false</em></td>
            </tr>
          </table>

        </section>

        <section title="Nested Elements">

          <p>
            The <strong>tomcat3x</strong> container supports the following
            nested elements:
          </p>

          <section title="conf">

            <p>
              A fileset that can be used to specify the set of files that
              should be placed into the <code>conf</code> directory of the
              installation directory. This fileset should not include the
              <code>serverxml</code> file.
            </p>

          </section>

        </section>

      </section>

      <section title="tomcat4x">

        <p>
          The nested element <strong>tomcat4x</strong> allows running the tests
          against the Apache Tomcat 4.x servlet container.
        </p>

        <section title="Parameters">

          <table>
            <tr>
              <th>Name</th>
              <th>Description</th>
              <th>Required</th>
            </tr>
            <tr>
              <td><strong>dir</strong></td>
              <td>
                The installation directory of the Tomcat 4.x server
              </td>
              <td>Yes</td>
            </tr>
            <tr>
              <td>serverxml</td>
              <td>
                The server configuration file to use instead of the default one
              </td>
              <td>No</td>
            </tr>
            <tr>
              <td>port</td>
              <td>
                The TCP port that the container should listen to
              </td>
              <td>No, default is 8080</td>
            </tr>
            <tr>
              <td>output</td>
              <td>
                Name of a file to write the output of the container to. If not
                specified, the standard output will be used
              </td>
              <td>No</td>
            </tr>
            <tr>
              <td>append</td>
              <td>
                Whether output should be appended to or overwrite an existing
                file.
              </td>
              <td>No, default is <em>false</em></td>
            </tr>
          </table>

        </section>

        <section title="Nested Elements">

          <p>
            The <strong>tomcat4x</strong> container supports the following
            nested elements:
          </p>

          <section title="conf">

            <p>
              A fileset that can be used to specify the set of files that
              should be placed into the <code>conf</code> directory of the
              installation directory. This fileset should not include the
              <code>serverxml</code> file.
            </p>

          </section>

        </section>

      </section>

      <section title="tomcat5x">

        <p>
          The nested element <strong>tomcat5x</strong> allows running the tests
          against the Apache Tomcat 5.x servlet container.
        </p>

        <section title="Parameters">

          <table>
            <tr>
              <th>Name</th>
              <th>Description</th>
              <th>Required</th>
            </tr>
            <tr>
              <td><strong>dir</strong></td>
              <td>
                The installation directory of the Tomcat 5.x server
              </td>
              <td>Yes</td>
            </tr>
            <tr>
              <td>serverxml</td>
              <td>
                The server configuration file to use instead of the default one
              </td>
              <td>No</td>
            </tr>
            <tr>
              <td>port</td>
              <td>
                The TCP port that the container should listen to
              </td>
              <td>No, default is 8080</td>
            </tr>
            <tr>
              <td>output</td>
              <td>
                Name of a file to write the output of the container to. If not
                specified, the standard output will be used
              </td>
              <td>No</td>
            </tr>
            <tr>
              <td>append</td>
              <td>
                Whether output should be appended to or overwrite an existing
                file.
              </td>
              <td>No, default is <em>false</em></td>
            </tr>
          </table>

        </section>

        <section title="Nested Elements">

          <p>
            The <strong>tomcat5x</strong> container supports the following
            nested elements:
          </p>

          <section title="conf">

            <p>
              A fileset that can be used to specify the set of files that
              should be placed into the <code>conf</code> directory of the
              installation directory. This fileset should not include the
              <code>serverxml</code> file.
            </p>

          </section>

        </section>

      </section>

    </section>

    <section title="Examples">

      <p>
        The following example demonstrates the simplest-possible use of the
        task.
      </p>

      <source><![CDATA[
<cactus warfile="${test.dir}/test.war" printsummary="yes"
    haltonfailure="no" failureproperty="tests.failed">
  <classpath>
    <path refid="cactus.runtime.classpath"/>
    <pathelement location="${build.classes.dir}"/>
    <pathelement location="${test.classes.dir}"/>
  </classpath>
  <containerset>
    <jboss2x dir="${jboss3x.home}" config="default"
        todir="${test.reports.dir}/jboss3x"/>
    <resin2x dir="${resin2x.home}" port="8080"
        todir="${test.reports.dir}/resin2x"/>
    <tomcat4x dir="${tomcat4x.home}" port="8080"
        todir="${test.reports.dir}/tomcat4x"/>
  </containerset>
  <formatter type="xml"/>
  <batchtest>
    <fileset dir="${src.test.dir}">
      <include name="**/Test*.java"/>
      <exclude name="**/TestAll.java"/>
    </fileset>
  </batchtest>
</cactus>
]]></source>

    </section>

  </section>

  </body>
</document>
