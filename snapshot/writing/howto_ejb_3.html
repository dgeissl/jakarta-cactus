<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">











<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title>Jakarta Cactus - EJB Testing with J2EE RI</title>
    <style type="text/css" media="all">
      @import url("../css/maven-base.css");
      @import url("../css/maven-theme.css");
      @import url("../css/site.css");
    </style>
    <link rel="stylesheet" href="../css/print.css" type="text/css" media="print" />
          </head>
  <body class="composite">
    <div id="banner">
                  <a href="http://jakarta.apache.org/cactus/" id="bannerLeft">
    
                                            <img src="../images/logocactus.gif" alt="" />
    
            </a>
                        <a href="http://jakarta.apache.org/" id="bannerRight">
    
                                            <img src="../images/jakarta-logo.gif" alt="" />
    
            </a>
            <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="breadcrumbs">
          
  

  
    
  
  
    
            <div class="xleft">
        Last Published: 2016-11-27
                          |   
                <a href="http://www.apache.org/" class="externalLink">Apache</a>
                &gt;
      
                <a href="http://www.jakarta.apache.org/" class="externalLink">Jakarta</a>
                &gt;
      
                <a href="http://jakarta.apache.org/cactus/" class="externalLink">Cactus</a>
                          </div>
            <div class="xright">      
  

  
    
  
  
    
  </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="leftColumn">
      <div id="navcolumn">
           
  

  
    
  
  
    
                   <h5>About</h5>
            <ul>
              
    <li class="none">
                    <a href="../index.html">Overview</a>
          </li>
              
    <li class="none">
                    <a href="../goals.html">Goals</a>
          </li>
              
    <li class="none">
                    <a href="../features.html">Features</a>
          </li>
              
    <li class="none">
                    <a href="../news.html">News</a>
          </li>
              
    <li class="none">
                    <a href="../downloads.html">Downloads</a>
          </li>
              
    <li class="none">
                    <a href="http://issues.apache.org/jira/secure/BrowseProject.jspa?id=10471" class="externalLink">Bug Database</a>
          </li>
              
    <li class="none">
                    <a href="../mail-lists.html">Mailing Lists</a>
          </li>
              
    <li class="none">
                    <a href="../faq.html">FAQ</a>
          </li>
              
    <li class="none">
                    <a href="http://wiki.apache.org/jakarta-cactus/FrontPage" class="externalLink">Wiki</a>
          </li>
              
    <li class="none">
                    <a href="../license.html">License</a>
          </li>
          </ul>
              <h5>Documentation</h5>
            <ul>
              
    <li class="none">
                    <a href="../getting_started.html">Getting started</a>
          </li>
              
    <li class="none">
                    <a href="../how_it_works.html">How it works</a>
          </li>
              
                
              
      
            
            
            
      
            
      
            
      
            
      
            
      
            
      
            
      
            
      
              
            <li class="expanded">
                    <a href="../writing/howto_ejb.html">Writing tests</a>
                  <ul>
                  
    <li class="none">
                    <a href="../writing/howto_ejb_j2eeri.html">Howto EJB</a>
          </li>
                  
    <li class="none">
              <strong>Howto EJB3</strong>
        </li>
                  
    <li class="none">
                    <a href="../writing/howto_httpunit.html">Howto HTTPUnit</a>
          </li>
                  
    <li class="none">
                    <a href="../writing/howto_htmlunit.html">Howto HTMLUnit</a>
          </li>
                  
    <li class="none">
                    <a href="../writing/howto_jsp.html">Howto JSP</a>
          </li>
                  
    <li class="none">
                    <a href="../writing/howto_security.html">Howto Security</a>
          </li>
                  
    <li class="none">
                    <a href="../writing/howto_testcase.html">Howto TestCase</a>
          </li>
                  
    <li class="none">
                    <a href="../writing/howto_testcase_jsp.html">Howto TestCase-JSP</a>
          </li>
                  
    <li class="none">
                    <a href="../writing/howto_testcase_filter.html">Howto TestCase-Filter</a>
          </li>
                  
    <li class="none">
                    <a href="../writing/howto_testcase_servlet.html">Howto TestCase-Servlet</a>
          </li>
              </ul>
        </li>
              
                
              
      
            
      
            
      
            
      
            
      
            
      
            
      
            
      
            
      
            
      
            
      
            
      
            
      
                  
      
            
      
            
      
            
      
            
      
            
      
            
      
            
      
                  
      
            
      
            
      
                  
      
            
      
            
      
              
        <li class="collapsed">
                    <a href="../integration/index.html">Running tests</a>
                </li>
              
                
              
      
            
      
            
      
            
      
            
      
            
      
            
      
            
      
            
      
              
        <li class="collapsed">
                    <a href="../participating/index.html">Participating</a>
                </li>
          </ul>
              <h5>Miscellaneous</h5>
            <ul>
              
    <li class="none">
                    <a href="../cactusname.html">Why the name</a>
          </li>
              
    <li class="none">
                    <a href="../mock_vs_cactus.html">Mock vs Container</a>
          </li>
              
    <li class="none">
                    <a href="http://wiki.apache.org/jakarta-cactus/TestedOn" class="externalLink">Tested On...</a>
          </li>
              
                
              
      
            
      
            
      
            
      
            
      
              
        <li class="collapsed">
                    <a href="../resources/index.html">Resources</a>
                </li>
          </ul>
              <h5>Translations</h5>
            <ul>
              
    <li class="none">
                    <a href="http://www.ressources-java.net/cactus" class="externalLink">French</a>
          </li>
              
    <li class="none">
                    <a href="http://jakarta.apache-korea.org/cactus/index.html" class="externalLink">Korean</a>
          </li>
              
    <li class="none">
                    <a href="http://www.jajakarta.org/cactus/" class="externalLink">Japanese</a>
          </li>
          </ul>
              <h5>See also</h5>
            <ul>
              
    <li class="none">
                    <a href="http://www.apachebookstore.com/" class="externalLink">Apache Bookstore</a>
          </li>
              
    <li class="none">
                    <a href="http://www.planetapache.org/" class="externalLink">Planet Apache</a>
          </li>
              
    <li class="none">
                    <a href="http://apache.org/foundation/thanks.html" class="externalLink">Apache Sponsors</a>
          </li>
          </ul>
                                                 
                        
                        
            <a href="http://jakarta.apache.org/cactus/" title="Jakarta Cactus" class="poweredBy">
                            <img alt="Jakarta Cactus" src="../images/cactusbanner.gif" />
            </a>
                               
  

  
    
  
  
    
        </div>
    </div>
    <div id="bodyColumn">
      <div id="contentBox">
        <div class="section"><h2><a name="Forewords"></a>Forewords</h2>
<p>
                This document explains how to unit test EJBs version 3.0 with Cactus. It is a good idea
                to have a look at the
                sample applications that come with Cactus's distribution in
                <code>samples/ejb3</code></p>
<p>
                This tutorial shows how to write test cases for unit testing
                EJB methods. The EJB used in this example is a simple Stateless Bean.
            </p>
<p>
                This tutorial assumes the reader has already understood how to use
                Cactus to test Servlet. To test an EJB, you need to prepare a war to
                contain the cactus setting and test cases, and then prepare a jar of
                your ejb. You need to match the JNDI name in the ejb jar and the war.
            </p>
</div>
<div class="section"><h2><a name="EJB_Jar"></a>EJB Jar</h2>
<div class="section"><h3><a name="Step_1:_Prepare_the_Sample_EJB"></a>Step 1: Prepare the Sample EJB</h3>
<p>
                    The EJB used in this tutorial is a simple Stateless Bean with a method
                    for converting Yen to Dollar.
                </p>
</div>
<div class="section"><h3><a name="EJB_Bean"></a>EJB Bean</h3>
<div class="source"><pre>
                    
package org.apache.cactus.sample.ejb3;

import javax.ejb.Stateless;

import org.apache.cactus.sample.ejb3.IConvertLocal;

/**
* Sample EJB3 bean.
*
* @version $Id: ConverterBean.java 238816 2008-06-31 16:36:46Z ptahchiev $
*/
@Stateless
public class ConverterBean implements IConvertLocal {
	
     /* (non-Javadoc)
      * @see org.apache.cactus.sample.ejb3.IConvertLocal#convert(double)
      */
      public double convert(double theYenAmount) {
         return theYenAmount / 100.0;
      }
}
       
                </pre>
</div>
</div>
<div class="section"><h3><a name="EJB_Local_Interface"></a>EJB Local Interface</h3>
<div class="source"><pre>
                    
package org.apache.cactus.sample.ejb3;

import java.io.Serializable;

import javax.ejb.Local;

/**
 * Sample EJB local interface
 *
 * @version $Id: IConverterLocal.java 238816 2008-06-31 16:36:46Z ptahchiev $
 */
@Local
public interface IConvertLocal extends Serializable
{
     /**
      * A method declaration to convert yen to dollars.
      *
      * @param theYenAmount
      * @return
      */
      public double convert(double theYenAmount);
}
                </pre>
</div>
</div>
</div>
<div class="section"><h2><a name="Prepare_deployment_descriptors"></a>Prepare deployment descriptors</h2>
<div class="section"><h3><a name="application.xml"></a>application.xml</h3>
<div class="source"><pre>
                    
&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;!DOCTYPE application
   PUBLIC '-//Sun Microsystems, Inc.//DTD J2EE Application 1.3//EN'
   'http://java.sun.com/j2ee/dtds/application_1_3.dtd'&gt;
&lt;application&gt;
   &lt;display-name&gt;cactus-sample-ejb&lt;/display-name&gt;
   &lt;description&gt;Cactus EJB3 Sample&lt;/description&gt;
   &lt;module&gt;
      &lt;ejb&gt;samples-ejb3-1.8.1-SNAPSHOT.ejb3&lt;/ejb&gt;
   &lt;/module&gt;
&lt;/application&gt;

                </pre>
</div>
</div>
</div>
<div class="section"><h2><a name="Cactus_Web_Application"></a>Cactus Web Application</h2>
<div class="section"><h3><a name="Step_1:_Prepare_test_code"></a>Step 1: Prepare test code</h3>
<div class="source"><pre>
                    
package org.apache.cactus.sample.ejb3;

import java.util.Properties;

import javax.naming.InitialContext;

import junit.framework.TestCase;

import org.apache.cactus.ServletTestCase;

/**
 * Sample Cactus test for a session bean.
 *
 * @version $Id: TestConverterEJB.java 238816 2004-02-29 16:36:46Z vmassol $
 */
public class TestConverterEJB extends ServletTestCase
{
      /**
       * Class under test
       */
      private IConvertLocal converter;
      /**
       * @see TestCase#setUp()
       */
      public void setUp() throws Exception
      {
         Properties properties = new Properties();
         properties.put(&quot;java.naming.factory.initial&quot;, &quot;org.jnp.interfaces.NamingContextFactory&quot;);
         properties.put(&quot;java.naming.factory.url.pkgs&quot;, &quot;org.jboss.naming rg.jnp.interfaces&quot;);
         properties.put(&quot;java.naming.provider.url&quot;, &quot;jnp://localhost:1099&quot;);
         InitialContext ctx = new InitialContext(properties);
         converter = (IConvertLocal) ctx.lookup(&quot;samples-ejb-1.8.1-SNAPSHOT-cactified/&quot;+ConverterBean.class.getSimpleName()+&quot;/local&quot;);
      }
      /**
       * Verify yen to dollars conversion works.
       * @throws Exception on error
       */
      public void testConvert() throws Exception
      {
         double dollar = this.converter.convert(100.0);
         assertEquals(&quot;dollar&quot;, 1.0, dollar, 0.01);
      }
}
							
                </pre>
</div>
</div>
<div class="section"><h3><a name="Step_2:_Prepare_Web_Application_Deployment_Descriptor_web.xml"></a>Step 2: Prepare Web Application Deployment Descriptor (web.xml)</h3>
<div class="source"><pre>
                    
&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
	&lt;!DOCTYPE web-app
						PUBLIC &quot;-//Sun Microsystems, Inc.//DTD Web Application 2.2//EN&quot;
						&quot;http://java.sun.com/j2ee/dtds/web-app_2.2.dtd&quot;&gt;
&lt;web-app&gt;
   &lt;servlet&gt;
      &lt;servlet-name&gt;ServletRedirector&lt;/servlet-name&gt;
      &lt;servlet-class&gt;org.apache.cactus.server.ServletTestRedirector&lt;/servlet-class&gt;
   &lt;/servlet&gt;
   &lt;servlet-mapping&gt;
      &lt;servlet-name&gt;ServletRedirector&lt;/servlet-name&gt;
      &lt;url-pattern&gt;/ServletRedirector&lt;/url-pattern&gt;
   &lt;/servlet-mapping&gt;

	[...]

   &lt;ejb-ref&gt;
      &lt;ejb-ref-name&gt;ejb/Converter&lt;/ejb-ref-name&gt;
      &lt;ejb-ref-type&gt;Session&lt;/ejb-ref-type&gt;
      &lt;home&gt;org.apache.cactus.sample.ejb.ConverterHome&lt;/home&gt;
      &lt;remote&gt;org.apache.cactus.sample.ejb.Converter&lt;/remote&gt;
   &lt;/ejb-ref&gt;
&lt;/web-app&gt;
                </pre>
</div>
</div>
<div class="section"><h3><a name="Step_3:_Package_Web_Application"></a>Step 3: Package Web Application</h3>
<p>
                    Package the web application into a war file.
                </p>
</div>
</div>
<div class="section"><h2><a name="Deploy"></a>Deploy</h2>
<p>
                You need to package the war file with all the additional jar files in an ear file
                and then deploy the ear file based on
                the deployment procedure of your servlet container and your ejb
                container.
            </p>
</div>

      </div>
    </div>
    <div class="clear">
      <hr/>
    </div>
    <div id="footer">
      <div class="xright">&#169;  
          2001-2016
    
          The Apache Software Foundation
          
  

  
    
  
  
    
  </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
  </body>
</html>
