<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">











<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title>Jakarta Cactus - Testing secure code Howto</title>
    <style type="text/css" media="all">
      @import url("../css/maven-base.css");
      @import url("../css/maven-theme.css");
      @import url("../css/site.css");
    </style>
    <link rel="stylesheet" href="../css/print.css" type="text/css" media="print" />
          </head>
  <body class="composite">
    <div id="banner">
                  <a href="http://jakarta.apache.org/cactus/" id="bannerLeft">
    
                                            <img src="../images/logocactus.gif" alt="" />
    
            </a>
                        <a href="http://jakarta.apache.org/" id="bannerRight">
    
                                            <img src="../images/jakarta-logo.gif" alt="" />
    
            </a>
            <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="breadcrumbs">
          
  

  
    
  
  
    
            <div class="xleft">
        Last Published: 2016-11-27
                          |   
                <a href="http://www.apache.org/" class="externalLink">Apache</a>
                &gt;
      
                <a href="http://www.jakarta.apache.org/" class="externalLink">Jakarta</a>
                &gt;
      
                <a href="http://jakarta.apache.org/cactus/" class="externalLink">Cactus</a>
                          </div>
            <div class="xright">      
  

  
    
  
  
    
  </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="leftColumn">
      <div id="navcolumn">
           
  

  
    
  
  
    
                   <h5>About</h5>
            <ul>
              
    <li class="none">
                    <a href="../index.html">Overview</a>
          </li>
              
    <li class="none">
                    <a href="../goals.html">Goals</a>
          </li>
              
    <li class="none">
                    <a href="../features.html">Features</a>
          </li>
              
    <li class="none">
                    <a href="../news.html">News</a>
          </li>
              
    <li class="none">
                    <a href="../downloads.html">Downloads</a>
          </li>
              
    <li class="none">
                    <a href="http://issues.apache.org/jira/secure/BrowseProject.jspa?id=10471" class="externalLink">Bug Database</a>
          </li>
              
    <li class="none">
                    <a href="../mail-lists.html">Mailing Lists</a>
          </li>
              
    <li class="none">
                    <a href="../faq.html">FAQ</a>
          </li>
              
    <li class="none">
                    <a href="http://wiki.apache.org/jakarta-cactus/FrontPage" class="externalLink">Wiki</a>
          </li>
              
    <li class="none">
                    <a href="../license.html">License</a>
          </li>
          </ul>
              <h5>Documentation</h5>
            <ul>
              
    <li class="none">
                    <a href="../getting_started.html">Getting started</a>
          </li>
              
    <li class="none">
                    <a href="../how_it_works.html">How it works</a>
          </li>
              
                
              
      
            
      
            
      
            
      
            
      
            
            
            
      
            
      
            
      
            
      
              
            <li class="expanded">
                    <a href="../writing/howto_ejb.html">Writing tests</a>
                  <ul>
                  
    <li class="none">
                    <a href="../writing/howto_ejb_j2eeri.html">Howto EJB</a>
          </li>
                  
    <li class="none">
                    <a href="../writing/howto_ejb_3.html">Howto EJB3</a>
          </li>
                  
    <li class="none">
                    <a href="../writing/howto_httpunit.html">Howto HTTPUnit</a>
          </li>
                  
    <li class="none">
                    <a href="../writing/howto_htmlunit.html">Howto HTMLUnit</a>
          </li>
                  
    <li class="none">
                    <a href="../writing/howto_jsp.html">Howto JSP</a>
          </li>
                  
    <li class="none">
              <strong>Howto Security</strong>
        </li>
                  
    <li class="none">
                    <a href="../writing/howto_testcase.html">Howto TestCase</a>
          </li>
                  
    <li class="none">
                    <a href="../writing/howto_testcase_jsp.html">Howto TestCase-JSP</a>
          </li>
                  
    <li class="none">
                    <a href="../writing/howto_testcase_filter.html">Howto TestCase-Filter</a>
          </li>
                  
    <li class="none">
                    <a href="../writing/howto_testcase_servlet.html">Howto TestCase-Servlet</a>
          </li>
              </ul>
        </li>
              
                
              
      
            
      
            
      
            
      
            
      
            
      
            
      
            
      
            
      
            
      
            
      
            
      
            
      
                  
      
            
      
            
      
            
      
            
      
            
      
            
      
            
      
                  
      
            
      
            
      
                  
      
            
      
            
      
              
        <li class="collapsed">
                    <a href="../integration/index.html">Running tests</a>
                </li>
              
                
              
      
            
      
            
      
            
      
            
      
            
      
            
      
            
      
            
      
              
        <li class="collapsed">
                    <a href="../participating/index.html">Participating</a>
                </li>
          </ul>
              <h5>Miscellaneous</h5>
            <ul>
              
    <li class="none">
                    <a href="../cactusname.html">Why the name</a>
          </li>
              
    <li class="none">
                    <a href="../mock_vs_cactus.html">Mock vs Container</a>
          </li>
              
    <li class="none">
                    <a href="http://wiki.apache.org/jakarta-cactus/TestedOn" class="externalLink">Tested On...</a>
          </li>
              
                
              
      
            
      
            
      
            
      
            
      
              
        <li class="collapsed">
                    <a href="../resources/index.html">Resources</a>
                </li>
          </ul>
              <h5>Translations</h5>
            <ul>
              
    <li class="none">
                    <a href="http://www.ressources-java.net/cactus" class="externalLink">French</a>
          </li>
              
    <li class="none">
                    <a href="http://jakarta.apache-korea.org/cactus/index.html" class="externalLink">Korean</a>
          </li>
              
    <li class="none">
                    <a href="http://www.jajakarta.org/cactus/" class="externalLink">Japanese</a>
          </li>
          </ul>
              <h5>See also</h5>
            <ul>
              
    <li class="none">
                    <a href="http://www.apachebookstore.com/" class="externalLink">Apache Bookstore</a>
          </li>
              
    <li class="none">
                    <a href="http://www.planetapache.org/" class="externalLink">Planet Apache</a>
          </li>
              
    <li class="none">
                    <a href="http://apache.org/foundation/thanks.html" class="externalLink">Apache Sponsors</a>
          </li>
          </ul>
                                                 
                        
                        
            <a href="http://jakarta.apache.org/cactus/" title="Jakarta Cactus" class="poweredBy">
                            <img alt="Jakarta Cactus" src="../images/cactusbanner.gif" />
            </a>
                               
  

  
    
  
  
    
        </div>
    </div>
    <div id="bodyColumn">
      <div id="contentBox">
        <div class="section"><h2><a name="Introduction_to_testing_secure_code"></a>Introduction to testing secure code</h2>
<p>
                Beginning with version 1.3, Cactus is able to unit test Servlet code
                that uses the Servlet Security API (<code>getRemoteUser()</code>,
                <code>isUserInRole()</code>, <code>getUserPrincipal()</code>).
                Cactus supports the BASIC and FORM authentication methods.
            </p>
<p>
                The way to perform this is by securing a Servlet Redirector defined
                in your <code>web.xml</code> and then to specify user credentials
                in your <code>beginXXX()</code>, as defined below.
            </p>
<note>
                The Cactus sample application demonstrates how to unit test everything
                that is explained here.
            </note></div>
<div class="section"><h2><a name="Step_1:_Passing_credentials_in_beginXXX"></a>Step 1: Passing credentials in beginXXX()</h2>
<p>
                Let's start with an example:
            </p>
<div class="source"><pre>
public void beginBasicAuthentication(WebRequest theRequest)
{
    theRequest.setRedirectorName(&quot;ServletRedirectorSecure&quot;);
    theRequest.setAuthentication(
        new BasicAuthentication(&quot;testuser&quot;, &quot;testpassword&quot;));
}

public void testBasicAuthentication()
{
    assertEquals(&quot;testuser&quot;, request.getUserPrincipal().getName());
    assertEquals(&quot;testuser&quot;, request.getRemoteUser());
    assertTrue(&quot;User not in 'test' role&quot;, request.isUserInRole(&quot;test&quot;));
}
</pre>
</div>
<p>
                There are several things to understand here:
            </p>
<ul><li>
                    The Servlet that is called on the server side is the Cactus
                    redirector servlet and thus we'll need to secure it in
                    our <code>web.xml</code> (see step 2 below).
                </li>
<li><code>WebRequest.setRedirectorName()</code>
                    is an API that lets you
                    override the redirector defined in <code>cactus.properties</code>.
                    This is needed here because we want to test both code that is not
                    secured (i.e. for which we don't want to have to pass credentials)
                    and code that is secured and thus we need 2 redirectors. The
                    <code>ServletRedirectorSecure</code>
                    redirector will be secured
                    in step 2 below.
                </li>
<li><code>WebRequest.setAuthentication()</code>
                    is used to pass
                    credentials to the server. It takes an implementation of the
                    <code>Authentication</code>
                    interface as argument. In this example,
                    we pass in a <code>BasicAuthentication</code> which corresponds to
                    the BASIC authentication method. Testing with form-based
                    authentication just involves using the
                    <code>FormAuthentication</code>
                    class instead of
                    <code>BasicAuthentication</code>.
                </li>
</ul>
</div>
<div class="section"><h2><a name="Step_2:_Securing_the_Cactus_Redirector"></a>Step 2: Securing the Cactus Redirector</h2>
<note>
                If you're using the Cactus Ant tasks to execute your Cactus
                tests, please check the <a href="../integration/ant/task_cactifywar.html">Cactifywar
                task
            </a> page as the configuration below is only required
                for manual configuration and is handled automatically by the
                Cactifywar task.
            </note><p>
                All calls to the server side go through the Cactus Servlet Redirector
                and thus it is that servlet that needs to be secured in
                <code>web.xml</code>. The required modifications to
                <code>web.xml</code>
                are as follows (example):
            </p>
<div class="source"><pre>
[...]

&lt;web-app&gt;

  &lt;servlet&gt;
    &lt;servlet-name&gt;ServletRedirector&lt;/servlet-name&gt;
    &lt;servlet-class&gt;org.apache.cactus.server.ServletTestRedirector&lt;/servlet-class&gt;
  &lt;/servlet&gt;

  &lt;servlet&gt;
    &lt;servlet-name&gt;ServletRedirectorSecure&lt;/servlet-name&gt;
    &lt;servlet-class&gt;org.apache.cactus.server.ServletTestRedirector&lt;/servlet-class&gt;
  &lt;/servlet&gt;

  [...]

  &lt;servlet-mapping&gt;
    &lt;servlet-name&gt;ServletRedirector&lt;/servlet-name&gt;
    &lt;url-pattern&gt;/ServletRedirector&lt;/url-pattern&gt;
  &lt;/servlet-mapping&gt;

  &lt;servlet-mapping&gt;
    &lt;servlet-name&gt;ServletRedirectorSecure&lt;/servlet-name&gt;
    &lt;url-pattern&gt;/ServletRedirectorSecure&lt;/url-pattern&gt;
  &lt;/servlet-mapping&gt;

  [...]

  &lt;!-- Start Authentication --&gt;

  &lt;security-constraint&gt;
    &lt;web-resource-collection&gt;
      &lt;web-resource-name&gt;SecurityRestriction&lt;/web-resource-name&gt;
      &lt;description&gt;Protect the Cactus redirector servlet.&lt;/description&gt;
      &lt;url-pattern&gt;/ServletRedirectorSecure&lt;/url-pattern&gt;
      &lt;http-method&gt;GET&lt;/http-method&gt;
      &lt;http-method&gt;POST&lt;/http-method&gt;
    &lt;/web-resource-collection&gt;
    &lt;auth-constraint&gt;
      &lt;description&gt;Authorized Users Group&lt;/description&gt;
      &lt;role-name&gt;test&lt;/role-name&gt;
    &lt;/auth-constraint&gt;
    &lt;user-data-constraint&gt;
      &lt;transport-guarantee&gt;NONE&lt;/transport-guarantee&gt;
    &lt;/user-data-constraint&gt;
  &lt;/security-constraint&gt;

  &lt;login-config&gt;
    &lt;auth-method&gt;BASIC&lt;/auth-method&gt;
  &lt;/login-config&gt;

  &lt;security-role&gt;
    &lt;description&gt;Test role&lt;/description&gt;
    &lt;role-name&gt;test&lt;/role-name&gt;
  &lt;/security-role&gt;

  &lt;!-- End Authentication --&gt;

&lt;/web-app&gt;
</pre>
</div>
</div>
<div class="section"><h2><a name="Step_3:_Map_UsersRoles"></a>Step 3: Map Users/Roles</h2>
<p>
                This step consists in defining authorized users and mapping them to the
                role defined in <code>web.xml</code> (e.g. in the example above, we have
                defined a <code>test</code> role).
            </p>
<p>
                This step is completely container-dependent and there is no standard
                way of doing it. You'll have to learn how to do it for your container.
                For example, here is how you would do it for Tomcat 4.0:
            </p>
<ul><li>
                    Create a <code>tomcat-users.xml</code> file that you put in your
                    Tomcat configuration directory (where you have
                    <code>server.xml</code>
                    defined).
                </li>
</ul>
<p>
                Here is an example of <code>tomcat-users.xml</code> that matches the
                test we have defined in step 1:
            </p>
<div class="source"><pre>
&lt;tomcat-users&gt;
  &lt;user name=&quot;testuser&quot; password=&quot;testpassword&quot; roles=&quot;test&quot; /&gt;
&lt;/tomcat-users&gt;
</pre>
</div>
</div>

      </div>
    </div>
    <div class="clear">
      <hr/>
    </div>
    <div id="footer">
      <div class="xright">&#169;  
          2001-2016
    
          The Apache Software Foundation
          
  

  
    
  
  
    
  </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
  </body>
</html>
