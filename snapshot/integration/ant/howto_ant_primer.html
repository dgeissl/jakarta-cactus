<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">











<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title>Jakarta Cactus - Ant Integration</title>
    <style type="text/css" media="all">
      @import url("../../css/maven-base.css");
      @import url("../../css/maven-theme.css");
      @import url("../../css/site.css");
    </style>
    <link rel="stylesheet" href="../../css/print.css" type="text/css" media="print" />
          </head>
  <body class="composite">
    <div id="banner">
                  <a href="http://jakarta.apache.org/cactus/" id="bannerLeft">
    
                                            <img src="../../images/logocactus.gif" alt="" />
    
            </a>
                        <a href="http://jakarta.apache.org/" id="bannerRight">
    
                                            <img src="../../images/jakarta-logo.gif" alt="" />
    
            </a>
            <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="breadcrumbs">
          
  

  
    
  
  
    
            <div class="xleft">
        Last Published: 2016-11-27
                          |   
                <a href="http://www.apache.org/" class="externalLink">Apache</a>
                &gt;
      
                <a href="http://www.jakarta.apache.org/" class="externalLink">Jakarta</a>
                &gt;
      
                <a href="http://jakarta.apache.org/cactus/" class="externalLink">Cactus</a>
                          </div>
            <div class="xright">      
  

  
    
  
  
    
  </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="leftColumn">
      <div id="navcolumn">
           
  

  
    
  
  
    
                   <h5>About</h5>
            <ul>
              
    <li class="none">
                    <a href="../../index.html">Overview</a>
          </li>
              
    <li class="none">
                    <a href="../../goals.html">Goals</a>
          </li>
              
    <li class="none">
                    <a href="../../features.html">Features</a>
          </li>
              
    <li class="none">
                    <a href="../../news.html">News</a>
          </li>
              
    <li class="none">
                    <a href="../../downloads.html">Downloads</a>
          </li>
              
    <li class="none">
                    <a href="http://issues.apache.org/jira/secure/BrowseProject.jspa?id=10471" class="externalLink">Bug Database</a>
          </li>
              
    <li class="none">
                    <a href="../../mail-lists.html">Mailing Lists</a>
          </li>
              
    <li class="none">
                    <a href="../../faq.html">FAQ</a>
          </li>
              
    <li class="none">
                    <a href="http://wiki.apache.org/jakarta-cactus/FrontPage" class="externalLink">Wiki</a>
          </li>
              
    <li class="none">
                    <a href="../../license.html">License</a>
          </li>
          </ul>
              <h5>Documentation</h5>
            <ul>
              
    <li class="none">
                    <a href="../../getting_started.html">Getting started</a>
          </li>
              
    <li class="none">
                    <a href="../../how_it_works.html">How it works</a>
          </li>
              
                
              
      
            
      
            
      
            
      
            
      
            
      
            
      
            
      
            
      
            
      
              
        <li class="collapsed">
                    <a href="../../writing/howto_ejb.html">Writing tests</a>
                </li>
              
                
              
      
            
      
            
      
            
      
            
      
            
            
            
      
            
      
            
      
            
      
            
      
            
      
            
      
                  
      
            
      
            
      
            
      
            
      
            
      
            
      
            
      
                  
      
            
      
            
      
                  
      
            
      
            
      
              
            <li class="expanded">
                    <a href="../../integration/index.html">Running tests</a>
                  <ul>
                  
    <li class="none">
                    <a href="../../integration/manual/index.html">Manual</a>
          </li>
                  
    <li class="none">
                    <a href="../../integration/eclipse/index.html">Eclipse</a>
          </li>
                  
                
              
      
            
      
            
            
            
      
            
      
            
      
            
      
            
      
            
      
            
      
              
            <li class="expanded">
                    <a href="../../integration/ant/index.html">Ant</a>
                  <ul>
                  
    <li class="none">
                    <a href="../../integration/ant/howto_ant_cactus.html">Howto Ant-Cactus</a>
          </li>
                  
    <li class="none">
                    <a href="../../integration/ant/howto_ant_install.html">Howto Ant-Install</a>
          </li>
                  
    <li class="none">
              <strong>Howto Ant-Primer</strong>
        </li>
                  
    <li class="none">
                    <a href="../../integration/ant/task_cactifyear.html">CactifyEar Task</a>
          </li>
                  
    <li class="none">
                    <a href="../../integration/ant/task_cactifywar.html">CactifyWar Task</a>
          </li>
                  
    <li class="none">
                    <a href="../../integration/ant/task_cactus.html">Cactus Task</a>
          </li>
                  
    <li class="none">
                    <a href="../../integration/ant/task_cactus1.8.html">Cactus Task 1.8</a>
          </li>
                  
    <li class="none">
                    <a href="../../integration/ant/task_resin.html">Resin Task</a>
          </li>
                  
    <li class="none">
                    <a href="../../integration/ant/task_runservertests.html">RunServerTests Task</a>
          </li>
                  
    <li class="none">
                    <a href="../../integration/ant/task_webxmlmerge.html">WebXmlMerge Task</a>
          </li>
              </ul>
        </li>
                  
    <li class="none">
                    <a href="../../integration/integration_browser.html">Browser</a>
          </li>
                  
    <li class="none">
                    <a href="../../integration/howto_tomcat.html">Tomcat</a>
          </li>
                  
                
              
      
            
      
            
      
            
      
            
      
              
        <li class="collapsed">
                    <a href="../../integration/maven/index.html">Maven</a>
                </li>
                  
                
              
      
            
      
              
        <li class="collapsed">
                    <a href="../../integration/maven2/index.html">Maven2</a>
                </li>
                  
    <li class="none">
                    <a href="../../integration/integration_jetty.html">Jetty</a>
          </li>
                  
    <li class="none">
                    <a href="../../integration/howto_ide.html">Various IDEs</a>
          </li>
                  
    <li class="none">
                    <a href="../../integration/howto_junitee.html">JUnitEE</a>
          </li>
              </ul>
        </li>
              
                
              
      
            
      
            
      
            
      
            
      
            
      
            
      
            
      
            
      
              
        <li class="collapsed">
                    <a href="../../participating/index.html">Participating</a>
                </li>
          </ul>
              <h5>Miscellaneous</h5>
            <ul>
              
    <li class="none">
                    <a href="../../cactusname.html">Why the name</a>
          </li>
              
    <li class="none">
                    <a href="../../mock_vs_cactus.html">Mock vs Container</a>
          </li>
              
    <li class="none">
                    <a href="http://wiki.apache.org/jakarta-cactus/TestedOn" class="externalLink">Tested On...</a>
          </li>
              
                
              
      
            
      
            
      
            
      
            
      
              
        <li class="collapsed">
                    <a href="../../resources/index.html">Resources</a>
                </li>
          </ul>
              <h5>Translations</h5>
            <ul>
              
    <li class="none">
                    <a href="http://www.ressources-java.net/cactus" class="externalLink">French</a>
          </li>
              
    <li class="none">
                    <a href="http://jakarta.apache-korea.org/cactus/index.html" class="externalLink">Korean</a>
          </li>
              
    <li class="none">
                    <a href="http://www.jajakarta.org/cactus/" class="externalLink">Japanese</a>
          </li>
          </ul>
              <h5>See also</h5>
            <ul>
              
    <li class="none">
                    <a href="http://www.apachebookstore.com/" class="externalLink">Apache Bookstore</a>
          </li>
              
    <li class="none">
                    <a href="http://www.planetapache.org/" class="externalLink">Planet Apache</a>
          </li>
              
    <li class="none">
                    <a href="http://apache.org/foundation/thanks.html" class="externalLink">Apache Sponsors</a>
          </li>
          </ul>
                                                 
                        
                        
            <a href="http://jakarta.apache.org/cactus/" title="Jakarta Cactus" class="poweredBy">
                            <img alt="Jakarta Cactus" src="../../images/cactusbanner.gif" />
            </a>
                               
  

  
    
  
  
    
        </div>
    </div>
    <div id="bodyColumn">
      <div id="contentBox">
        <div class="section"><h2><a name="Continuous_integration"></a>Continuous integration</h2>
<note><strong>This tutorial was written when I wrote Cactus 1.2. Since then
                    I have improved my command of Ant. However this tutorial has not yet
                    been updated. I believe it still provides some very good
                    methodology on how to use Ant, although not the latest. If you wish to
                    keep track of the latest change, have a look at the Cactus build files,
                    found in the source distribution.
                </strong></note><p>
                A strong principle of eXtreme Programming (XP) is the continuous
                integration aspect (see the
                <a href="http://www.martinfowler.com/articles/continuousIntegration.html" class="externalLink">
                    Continuous Integration
                </a>
                article by Martin Fowler). The traditional
                approach has been
                to developing the code first, then test it and then integrate
                it with other applications. The continuous integration principle is to
                develop code, test and integrate at the same time, i.e. at any point
                in time, you have a functioning code along with tests and integrated.
            </p>
<p>
                In order to be able to do continuous integration, you need to be able
                to automatically run the build for your application, including passing
                the unit tests (based on JUnit, Cactus, HttpUnit or others). Ant is
                the perfect tool for this task.
            </p>
</div>
<div class="section"><h2><a name="Ant_benefits"></a>Ant benefits</h2>
<p>
                The benefits of using Ant for running unit tests are as follows:
            </p>
<table class="bodyTable"><tr class="a"><th>
                        Benefits
                    </th>
</tr>
<tr class="b"><td>
                        Ant is written in Java and thus the same scripts can be used on
                        several systems (Windows and Unix for example). Is is therefore very
                        well suited for building java applications.
                    </td>
</tr>
<tr class="a"><td>
                        Ant provides enough built-in and optional tasks to be able to
                        achieve almost any needed build task without needing to use
                        system dependent scripts.
                    </td>
</tr>
<tr class="b"><td>
                        By being able to very quickly rerun unit test you can verify that
                        your tests still pass when you modify some part of your code (
                        regression testing)
                    </td>
</tr>
<tr class="a"><td>
                        As it is automated, it fits well in the continuous integration
                        principle and your tests can thus be ran automatically and
                        continously
                    </td>
</tr>
</table>
</div>
<div class="section"><h2><a name="Writing_an_Ant_build_script_tutorial"></a>Writing an Ant build script tutorial</h2>
<p>
                The sample Ant build file described below is taken from the
                <a href="../../downloads.html">Cactus Sample for Servlet API 2.2
                </a>
                project.
            </p>
<note>
                This section is both a tutorial for automating builds and unit testing
                with Ant and Cactus and also a best practice and methodology guide
                for using Ant in general (independent of Cactus). This is an Ant
                configuration that has been working for me on several project. Of course,
                you are free to adapt/modify it to suit your needs.
            </note><div class="section"><h2><a name="Project_directory_structure"></a>Project directory structure</h2>
<p>
                    Create the following directories:
                </p>
<table class="bodyTable"><tr class="b"><th>
                            Directory name
                        </th>
<th>
                            Content of the directory
                        </th>
</tr>
<tr class="a"><td><code>build</code></td>
<td>
                            The Ant build file and some other ancillary files (properties file, ...)
                        </td>
</tr>
<tr class="b"><td><code>conf</code></td>
<td>
                            Configuration files for the project. These are the configuration
                            files that will <em>not</em> be put into the runtime jar. They
                            are configuration file that need to be visible and modifyable
                            by a user of the project. If they were bundled in the jar they
                            would be hard to modify. On the other hand, we don't want a
                            proliferation of configuration files, so all
                            <em>technical</em>
                            configuration files (messages to display for errors, ...)
                            should be put in the <code>src</code> directory in correct java
                            packages.
                        </td>
</tr>
<tr class="a"><td><code>conf/test</code></td>
<td>
                            Configuration files needed for testing the project only.
                        </td>
</tr>
<tr class="b"><td><code>docs</code></td>
<td>
                            Project documentation.
                        </td>
</tr>
<tr class="a"><td><code>docs/skins</code></td>
<td>
                            Documentation skin for Stylebook (if using Stylebook).
                        </td>
</tr>
<tr class="b"><td><code>docs/xdocs</code></td>
<td>
                            Documentation files (XML files) for Stylebook (if using Stylebook).
                        </td>
</tr>
<tr class="a"><td><code>src</code></td>
<td>
                            The project sources: java files + java test files +
                            properties files + test properties files + other files for
                            runtime or test (XML files, ...). Note that all test files
                            should begin by 'Test' or 'test' in order to easily separate them
                            from other files so that in an Ant target we'll be able to include
                            only the runtime files.
                        </td>
</tr>
<tr class="b"><td><code>web</code></td>
<td>
                            The project web files: HTML, JSP, ... (if any)
                        </td>
</tr>
</table>
<note>
                    An <code>out</code> directory will be created by the Ant build. All
                    build-generated files will be put in that directory (compiled classes,
                    generated javadoc documentation, test configuration files for running
                    an application server, ...).
                </note><note>
                    We don't have any <code>lib</code> directory because it is always
                    better not to include dependent jars in your project whenever
                    possible for the following reasons: better continuous integration
                    with other libraries (meaning they also evolve and you should test
                    as much as possible with the latest version to discover potential
                    problems early, more lightweight downloads, less jar proliferation
                    (you'll end up with tens of the same jars otherwise), more version
                    control and integration checks (if your project uses 2 external
                    libraries that need another third library but not in the same version
                    you are in trouble !), ...
                </note></div>
<div class="section"><h2><a name="Ant_Target_List"></a>Ant Target List</h2>
<p>
                    Define the following targets in your <code>build.xml</code>.
                </p>
<note>
                    The <em>Type</em> column specify whether the target is an external
                    target that can be called by the user of the build file or if it is
                    an internal target, intended to be called internally by another
                    target inside the build script.
                </note><table class="bodyTable"><tr class="a"><th>
                            Target name
                        </th>
<th>
                            Description
                        </th>
<th>
                            Type
                        </th>
</tr>
<tr class="b"><td><jump anchor="init"><code>init</code></jump></td>
<td>
                            Defines token filters, timestamp, display some information on
                            screen, ...
                        </td>
<td>
                            Internal
                        </td>
</tr>
<tr class="a"><td><jump anchor="usage"><code>usage</code></jump></td>
<td>
                            Display usage information about the targets.
                        </td>
<td>
                            External
                        </td>
</tr>
<tr class="b"><td><jump anchor="prepare"><code>prepare</code></jump></td>
<td>
                            Set up the output directory where build generated files will be
                            put and copy the java sources to this output directory,
                            replacing tokens with the values defined in the
                            <code>init</code>
                            target.
                        </td>
<td>
                            Internal
                        </td>
</tr>
<tr class="a"><td><jump anchor="compile"><code>compile</code></jump></td>
<td>
                            Compile the java sources and put the result in the output
                            directory. All copies non java source files such as
                            <code>.properties</code>
                            files, XML configuration files, ...
                        </td>
<td>
                            Internal
                        </td>
</tr>
<tr class="b"><td><jump anchor="source"><code>source</code></jump></td>
<td>
                            Generate a zipped file containing the full sources of the project
                            (i.e. the whole directory structure, excluding any build
                            generated files).
                        </td>
<td>
                            External
                        </td>
</tr>
<tr class="a"><td><jump anchor="javadoc"><code>javadoc</code></jump></td>
<td>
                            Generates the javadoc of the project. This javadoc will be part
                            of the project documentation, as generated by the
                            <code>doc</code>
                            target.
                        </td>
<td>
                            Internal
                        </td>
</tr>
<tr class="b"><td><jump anchor="doc"><code>doc</code></jump></td>
<td>
                            Generates the full project documentation: javadoc + README files
                            + documentation web site (using Stylebook for example).
                        </td>
<td>
                            External
                        </td>
</tr>
<tr class="a"><td><jump anchor="clean"><code>clean</code></jump></td>
<td>
                            Remove any build generated files. In particular, delete the
                            output directory.
                        </td>
<td>
                            External
                        </td>
</tr>
<tr class="b"><td><jump anchor="jar"><code>jar</code></jump>
                            ,
                            <jump anchor="war"><code>war</code></jump>
                            ,
                            <code>ear</code>, ...
                        </td>
<td>
                            Generate the project runtime. If the project is a framework, it
                            is usually a jar. If the project is a web application, it is
                            usually a war file. If the project is an EJB application, it is
                            usually either one or several jars or an ear file. Etc ...
                        </td>
<td>
                            External
                        </td>
</tr>
<tr class="a"><td><jump anchor="tests"><code>tests_XXX</code></jump>
                            where XXX is
                            the name of the servlet engine on which the tests run.
                        </td>
<td>
                            Run the Cactus unit tests.
                        </td>
<td>
                            External
                        </td>
</tr>
</table>
</div>
<anchor id="basedir"><div class="section"><h2><a name="Step_1:_The_Ant_project_basedir"></a>Step 1: The Ant project basedir</h2>
<p>
                    You <code>build.xml</code> file being in located in
                    <code>build/</code>
                    you should set the <code>project</code> tag
                    <code>basedir</code>
                    attribute to '<code>..</code>' so that all other paths are relative
                    to your project root directory. Indeed, the batch file (shell script)
                    that was used to bootstrap Ant is located in
                    <code>&lt;root&gt;/build</code>, so '<code>..</code>' is the root
                    directory.
                </p>
<p>
                    Example:
                </p>
<div class="source"><pre>
&lt;?xml version=&quot;1.0&quot;?&gt;
[...]
&lt;project name=&quot;Cactus Sample&quot; default=&quot;war&quot; basedir=&quot;..&quot;&gt;
</pre>
</div>
</div>
<div class="section"><h2><a name="Step_2:_initialization_of_project_properties"></a>Step 2: initialization of project properties</h2>
<p>
                    You should define as properties all values that can be factorized
                    and which are used often in your build file such as source locations,
                    output locations, external jar locations and names, ... You can also
                    define useful file patterns there (see the sample below).
                </p>
<p>
                    A good principle is to defined any properties that depend on your
                    environment (such as external jar locations) in a file (let's call
                    it <code>build.properties</code> located either where
                    <code>build.xml</code>
                    is located or in your home directory. The
                    properties defined in this file will be loaded by
                    <code>build.xml</code>
                    using the following code:
                </p>
<div class="source"><pre>
    &lt;!-- Give user a chance to override without editing this file
         (and without typing -D each time it compiles it) --&gt;
    &lt;property file=&quot;build/build.properties&quot; /&gt;
    &lt;property file=&quot;${user.home}/build.properties&quot; /&gt;
</pre>
</div>
<p>
                    Here are our properties initializations:
                </p>
<div class="source"><pre>
&lt;project name=&quot;Cactus Sample&quot; default=&quot;war&quot; basedir=&quot;..&quot;&gt;

    &lt;!-- Give user a chance to override without editing this file
         (and without typing -D each time it compiles it) --&gt;
    &lt;property file=&quot;build/build.properties&quot; /&gt;
    &lt;property file=&quot;${user.home}/build.properties&quot; /&gt;

    &lt;!-- Generic project properties --&gt;
    &lt;property name=&quot;project.fullname&quot; value=&quot;Cactus Sample&quot;/&gt;
    &lt;property name=&quot;project.version&quot; value=&quot;@version@&quot;/&gt;
    &lt;property name=&quot;project.name&quot; value=&quot;cactus-sample&quot;/&gt;

    &lt;!-- Miscellaneous settings --&gt;
    &lt;property name=&quot;year&quot; value=&quot;@year@&quot;/&gt;
    &lt;property name=&quot;debug&quot; value=&quot;on&quot;/&gt;
    &lt;property name=&quot;optimize&quot; value=&quot;off&quot;/&gt;
    &lt;property name=&quot;deprecation&quot; value=&quot;off&quot;/&gt;

    &lt;!--
       ========================================================================
         Set the properties related to the source tree
       ========================================================================
    --&gt;
    &lt;!-- Source locations for the build --&gt;
    &lt;property name=&quot;src.dir&quot; value=&quot;src&quot;/&gt;
    &lt;property name=&quot;src.java.dir&quot; value=&quot;${src.dir}/share&quot;/&gt;
    &lt;property name=&quot;src.java.servlet.dir&quot; value=&quot;${src.dir}/servlet@servlet.api@&quot;/&gt;
    &lt;property name=&quot;build.dir&quot; value=&quot;build&quot;/&gt;
    &lt;property name=&quot;etc.dir&quot; value=&quot;${build.dir}/etc&quot;/&gt;
    &lt;property name=&quot;lib.dir&quot; value=&quot;lib&quot;/&gt;
    &lt;property name=&quot;conf.dir&quot; value=&quot;conf&quot;/&gt;
    &lt;property name=&quot;conf.test.dir&quot; value=&quot;conf/test&quot;/&gt;
    &lt;property name=&quot;web.dir&quot; value=&quot;web&quot;/&gt;

    &lt;!--
       ========================================================================
         Set the properties related to the build area
       ========================================================================
    --&gt;
    &lt;!-- Destination locations for the build (relative to the basedir as --&gt;
    &lt;!-- specified in the basedir attribute of the project tag)          --&gt;
    &lt;property name=&quot;out.dir&quot; value=&quot;out&quot;/&gt;
    &lt;property name=&quot;out.dist.dir&quot; value=&quot;${out.dir}/dist&quot;/&gt;
    &lt;property name=&quot;out.lib.dir&quot; value=&quot;${out.dir}/lib&quot;/&gt;
    &lt;property name=&quot;out.test.dir&quot; value=&quot;${out.dir}/test&quot;/&gt;
    &lt;property name=&quot;out.src.dir&quot; value=&quot;${out.dir}/src&quot;/&gt;
    &lt;property name=&quot;out.classes.dir&quot; value=&quot;${out.dir}/classes&quot;/&gt;
    &lt;property name=&quot;out.doc.dir&quot; value=&quot;${out.dir}/doc&quot;/&gt;
    &lt;property name=&quot;out.javadoc.dir&quot; value=&quot;${out.doc.dir}/javadoc&quot;/&gt;
    &lt;property name=&quot;out.conf.dir&quot; value=&quot;${out.dir}/conf&quot;/&gt;

    &lt;!-- Names of deliverables --&gt;

    &lt;!-- The Cactus Sample war file. This is the file that should be
         used at runtime by end users (it excludes the test classes) --&gt;
    &lt;property name=&quot;final.war.name&quot; value=&quot;${out.dir}/${project.name}-@servlet.api@.war&quot;/&gt;

    &lt;!-- The full sources of Cactus Sample in a zip file --&gt;
    &lt;property name=&quot;final.src.name&quot; value=&quot;${out.dir}/${project.name}-src-@servlet.api@.zip&quot;/&gt;

    &lt;!-- The Cactus sample documentation in a zip file --&gt;
    &lt;property name=&quot;final.doc.name&quot; value=&quot;${out.dir}/${project.name}-doc-@servlet.api@.zip&quot;/&gt;

    &lt;!--
       ========================================================================
         Useful file patterns for targets
       ========================================================================
    --&gt;
    &lt;!-- All source files of the projet. These source files will be copied
         to the destination source directory in the prepare task --&gt;
    &lt;patternset id=&quot;all.src.files&quot;&gt;

        &lt;!-- All java files --&gt;
        &lt;include name=&quot;**/*.java&quot;/&gt;

        &lt;!-- All doc files --&gt;
        &lt;include name=&quot;**/package.html&quot;/&gt;
        &lt;include name=&quot;**/overview.html&quot;/&gt;

        &lt;!-- All conf files (including test files) --&gt;
        &lt;include name=&quot;**/*.txt&quot;/&gt;
        &lt;include name=&quot;**/*.xml&quot;/&gt;
        &lt;include name=&quot;**/*.properties&quot;/&gt;

    &lt;/patternset&gt;

    &lt;!-- All non java files in the src directory --&gt;
    &lt;patternset id=&quot;all.nonjava.files&quot;&gt;

        &lt;!-- All conf files (including test files) --&gt;
        &lt;include name=&quot;**/*.txt&quot;/&gt;
        &lt;include name=&quot;**/*.xml&quot;/&gt;
        &lt;include name=&quot;**/*.properties&quot;/&gt;

    &lt;/patternset&gt;
</pre>
</div>
</div>
<anchor id="init"><div class="section"><h2><a name="Step_3:_init_target"></a>Step 3: 'init' target</h2>
<p>
                    Useful for initializing a timestamp (DSTAMP, TODAY, TSTAMP), defining
                    token filters, printing some information messages, registering
                    custom Ant tasks, ...
                </p>
<div class="source"><pre>
    &lt;!--
       ========================================================================
         Initialize the build. Must be called by all targets
       ========================================================================
    --&gt;
    &lt;target name=&quot;init&quot;&gt;

        &lt;!-- So that we can use the ${TSTAMP}, ${DSTAMP}, ... time stamps
             in targets, if need be --&gt;
        &lt;tstamp/&gt;

        &lt;echo message=&quot;--------- ${project.fullname} ${project.version} ---------&quot;/&gt;
        &lt;echo message=&quot;&quot;/&gt;

        &lt;echo message=&quot;java.class.path = ${java.class.path}&quot;/&gt;
        &lt;echo message=&quot;&quot;/&gt;
        &lt;echo message=&quot;java.home = ${java.home}&quot;/&gt;
        &lt;echo message=&quot;user.home = ${user.home}&quot;/&gt;
        &lt;echo message=&quot;&quot;/&gt;
        &lt;echo message=&quot;basedir = ${basedir}&quot;/&gt;
        &lt;echo message=&quot;&quot;/&gt;
        &lt;echo message=&quot;servlet.jar = ${servlet.jar}&quot;/&gt;
        &lt;echo message=&quot;cactus.jar = ${cactus.jar}&quot;/&gt;
        &lt;echo message=&quot;junit.jar = ${junit.jar}&quot;/&gt;
        &lt;echo message=&quot;cactus.ant.jar = ${cactus.ant.jar}&quot;/&gt;

        &lt;!-- Filters --&gt;
        &lt;filter token=&quot;version&quot; value=&quot;${project.version}&quot;/&gt;
        &lt;filter token=&quot;year&quot; value=&quot;${year}&quot;/&gt;

        &lt;!-- Initialize custom Ant tasks needed for running the server tests --&gt;
        &lt;taskdef resource=&quot;cactus.tasks&quot;&gt;
            &lt;classpath&gt;
                &lt;pathelement location=&quot;${cactus.ant.jar}&quot;/&gt;
                &lt;pathelement path=&quot;${java.class.path}&quot;/&gt;
            &lt;/classpath&gt;
        &lt;/taskdef&gt;

    &lt;/target&gt;
</pre>
</div>
</div>
<anchor id="usage"><div class="section"><h2><a name="Step_4:_usage_targets"></a>Step 4: 'usage' targets</h2>
<p>
                    Display a usage message.
                </p>
<div class="source"><pre>
    &lt;!--
       ========================================================================
         Help on usage. List available targets
       ========================================================================
    --&gt;
    &lt;target name=&quot;usage&quot; depends=&quot;init&quot;&gt;

        &lt;echo message=&quot;&quot;/&gt;
        &lt;echo message=&quot;${project.fullname} build file&quot;/&gt;
        &lt;echo message=&quot;------------------------------------------------------&quot;/&gt;
        &lt;echo message=&quot;&quot;/&gt;
        &lt;echo message=&quot; Available targets are:&quot;/&gt;
        &lt;echo message=&quot;&quot;/&gt;
        &lt;echo message=&quot; war    --&gt; generates the war file (default)&quot;/&gt;
        &lt;echo message=&quot; clean  --&gt; cleans up the build directory&quot;/&gt;
        &lt;echo message=&quot; source --&gt; generates source zip of the project&quot;/&gt;
        &lt;echo message=&quot; doc    --&gt; generates the docs (javadoc, ...)&quot;/&gt;
        &lt;echo message=&quot; all    --&gt; do it all at once&quot;/&gt;
        &lt;echo message=&quot;            (clean, war, source, doc)&quot;/&gt;
        &lt;echo message=&quot;&quot;/&gt;
        &lt;echo message=&quot; Targets for running the tests for Servlet API 2.2:&quot;/&gt;
        &lt;echo message=&quot;&quot;/&gt;
        &lt;echo message=&quot; tests_resin_12    --&gt; run tests for Resin 1.2&quot;/&gt;
        &lt;echo message=&quot; tests_tomcat_32   --&gt; run tests for Tomcat 3.2&quot;/&gt;
        &lt;echo message=&quot; tests_weblogic_51 --&gt; run tests for WebLogic 5.1&quot;/&gt;
        &lt;echo message=&quot; tests_orion_14    --&gt; run tests for Orion 1.4&quot;/&gt;
        &lt;echo message=&quot;&quot;/&gt;

    &lt;/target&gt;
</pre>
</div>
</div>
<anchor id="prepare"><div class="section"><h2><a name="Step_5:_prepare_target"></a>Step 5: 'prepare' target</h2>
<p>
                    This target is needed for both compiling and generating the javadoc.
                    It copies all the source files from their <code>src/</code> directory
                    to the <code>out</code> directory, replacing tokens in the source
                    code (replacing the <code>@version@</code> by the version number
                    for example).
                </p>
<div class="source"><pre>
    &lt;!--
       ========================================================================
         Prepare the output directory by copying the source files into it
       ========================================================================
    --&gt;
    &lt;target name=&quot;prepare&quot; depends=&quot;init&quot;&gt;

        &lt;mkdir dir=&quot;${out.src.dir}&quot;/&gt;

        &lt;!-- Copy all source files to destination dir. Apply the filters in
             order to replace the tokens for the copyright year and the
             version --&gt;
        &lt;copy todir=&quot;${out.src.dir}&quot; filtering=&quot;on&quot;&gt;
            &lt;fileset dir=&quot;${src.java.dir}&quot;&gt;
                &lt;patternset refid=&quot;all.src.files&quot;/&gt;
            &lt;/fileset&gt;
            &lt;fileset dir=&quot;${src.java.servlet.dir}&quot;&gt;
                &lt;patternset refid=&quot;all.src.files&quot;/&gt;
            &lt;/fileset&gt;
        &lt;/copy&gt;

    &lt;/target&gt;
</pre>
</div>
</div>
<anchor id="compile"><div class="section"><h2><a name="Step_6:_compile_target"></a>Step 6: 'compile' target</h2>
<p>
                    The <code>compile</code> target simply compiles the java files into
                    <code>.class</code>
                    files and also copies the support files that are
                    in <code>src/</code> to the directory where the class file have been
                    generated.
                </p>
<div class="source"><pre>
    &lt;!--
       ========================================================================
         Compiles the source directory
       ========================================================================
    --&gt;
    &lt;!-- Preparation target for the compile target --&gt;
    &lt;target name=&quot;prepare-compile&quot; depends=&quot;prepare&quot;&gt;

        &lt;mkdir dir=&quot;${out.classes.dir}&quot;/&gt;

    &lt;/target&gt;

    &lt;!-- Run the java compilation --&gt;
    &lt;target name=&quot;compile&quot; depends=&quot;prepare-compile&quot;&gt;

        &lt;javac srcdir=&quot;${out.src.dir}&quot;
            destdir=&quot;${out.classes.dir}&quot;
            debug=&quot;${debug}&quot;
            deprecation=&quot;${deprecation}&quot;
            optimize=&quot;${optimize}&quot;&gt;

            &lt;!-- Exclude all files that are not .java source files --&gt;

            &lt;!-- All doc files --&gt;
            &lt;exclude name=&quot;**/package.html&quot;/&gt;
            &lt;exclude name=&quot;**/overview.html&quot;/&gt;

            &lt;!-- All conf files (including test files) --&gt;
            &lt;exclude name=&quot;**/*.txt&quot;/&gt;
            &lt;exclude name=&quot;**/*.xml&quot;/&gt;
            &lt;exclude name=&quot;**/*.properties&quot;/&gt;

            &lt;classpath&gt;
                &lt;pathelement path=&quot;${java.class.path}&quot;/&gt;
                &lt;pathelement location=&quot;${servlet.jar}&quot;/&gt;
                &lt;pathelement location=&quot;${cactus.jar}&quot;/&gt;
            &lt;/classpath&gt;

        &lt;/javac&gt;

        &lt;!-- Copies non java files that need to be in the classes directory --&gt;
        &lt;copy todir=&quot;${out.classes.dir}&quot;&gt;
            &lt;fileset dir=&quot;${src.java.dir}&quot;&gt;
                &lt;patternset refid=&quot;all.nonjava.files&quot;/&gt;
            &lt;/fileset&gt;
            &lt;fileset dir=&quot;${conf.test.dir}&quot;&gt;
                &lt;include name=&quot;cactus.properties&quot;/&gt;
            &lt;/fileset&gt;
        &lt;/copy&gt;

    &lt;/target&gt;
</pre>
</div>
</div>
<anchor id="source"><div class="section"><h2><a name="Step_7:_source_target"></a>Step 7: 'source' target</h2>
<p>
                    Zip up the sources for distribution.
                </p>
<div class="source"><pre>
    &lt;!--
       ========================================================================
         Generates source zip of the project
       ========================================================================
    --&gt;
    &lt;target name=&quot;source&quot; depends=&quot;prepare&quot;&gt;

        &lt;zip zipfile=&quot;${final.src.name}&quot; basedir=&quot;.&quot;&gt;

            &lt;exclude name=&quot;${out.dir}/**&quot;/&gt;
            &lt;exclude name=&quot;**/*.log&quot;/&gt;
            &lt;exclude name=&quot;**/*.bak&quot;/&gt;
            &lt;exclude name=&quot;**/*.class&quot;/&gt;
            &lt;exclude name=&quot;${build.dir}/build.properties&quot;/&gt;

        &lt;/zip&gt;

    &lt;/target&gt;
</pre>
</div>
</div>
<anchor id="javadoc"><div class="section"><h2><a name="Step_8:_javadoc_target"></a>Step 8: 'javadoc' target</h2>
<p>
                    Generate the project's javadoc.
                </p>
<div class="source"><pre>
    &lt;!--
       ========================================================================
         Generate the javadoc
       ========================================================================
    --&gt;
    &lt;!-- Preparation target for the javadoc target --&gt;
    &lt;target name=&quot;prepare-javadoc&quot; depends=&quot;prepare&quot;&gt;

        &lt;mkdir dir=&quot;${out.javadoc.dir}&quot;/&gt;

    &lt;/target&gt;

    &lt;!-- Generate the javadoc for the current Servlet API --&gt;
    &lt;target name=&quot;javadoc&quot; depends=&quot;prepare-javadoc&quot;&gt;

        &lt;javadoc
            sourcepath=&quot;${out.src.dir}&quot;
            packagenames=&quot;org.apache.cactus.sample.*&quot;
            destdir=&quot;${out.javadoc.dir}&quot;
            author=&quot;true&quot;
            public=&quot;true&quot;
            version=&quot;true&quot;
            use=&quot;true&quot;
            windowtitle=&quot;${project.fullname} ${project.version} for Servlet @servlet.api@ API&quot;
            doctitle=&quot;${project.fullname} ${project.version} for Servlet @servlet.api@ API&quot;
            bottom=&quot;Copyright &amp;amp;copy; ${year} Apache Software Foundation. All Rights Reserved.&quot;&gt;

            &lt;classpath&gt;
                &lt;pathelement path=&quot;${java.class.path}&quot;/&gt;
                &lt;pathelement location=&quot;${servlet.jar}&quot;/&gt;
                &lt;pathelement location=&quot;${cactus.jar}&quot;/&gt;
            &lt;/classpath&gt;

        &lt;/javadoc&gt;

    &lt;/target&gt;
</pre>
</div>
</div>
<anchor id="doc"><div class="section"><h2><a name="Step_9:_doc_target"></a>Step 9: 'doc' target</h2>
<p>
                    Generate the project's documentation. It includes the javadoc,
                    additional README files (if any) and the documentation web site
                </p>
<p>
                    Example:
                </p>
<div class="source"><pre>
    &lt;!--
       ========================================================================
         Generate the full documentation
       ========================================================================
    --&gt;
    &lt;!-- Preparation target for the doc target --&gt;
    &lt;target name=&quot;prepare-doc&quot; depends=&quot;javadoc&quot;&gt;

        &lt;mkdir dir=&quot;${out.doc.dir}&quot;/&gt;

    &lt;/target&gt;

    &lt;!-- Generate the documentation --&gt;
    &lt;target name=&quot;doc&quot; depends=&quot;prepare-doc&quot;&gt;

        &lt;!-- Create the zipped documentation --&gt;
        &lt;zip zipfile=&quot;${final.doc.name}&quot; basedir=&quot;${out.doc.dir}&quot;/&gt;

    &lt;/target&gt;
</pre>
</div>
</div>
<anchor id="clean"><div class="section"><h2><a name="Step_10:_clean_target"></a>Step 10: 'clean' target</h2>
<p>
                    Removes all build generated files.
                </p>
<div class="source"><pre>
    &lt;!--
       ========================================================================
         Remove all build generated files
       ========================================================================
    --&gt;
    &lt;target name=&quot;clean&quot; depends=&quot;init&quot;&gt;

        &lt;!-- Deletes all files ending with '~' --&gt;
        &lt;delete&gt;
            &lt;fileset dir=&quot;.&quot; includes=&quot;**/*~&quot; defaultexcludes=&quot;no&quot;/&gt;
        &lt;/delete&gt;

        &lt;!-- Remove the out directory --&gt;
        &lt;delete dir=&quot;${out.dir}&quot;/&gt;

        &lt;!-- Delete log files --&gt;
        &lt;delete&gt;
            &lt;fileset dir=&quot;.&quot;&gt;
                &lt;include name=&quot;**/*.log&quot;/&gt;
            &lt;/fileset&gt;
        &lt;/delete&gt;

    &lt;/target&gt;
</pre>
</div>
</div>
<div class="section"><h2><a name="Step_11:_jar_war_targets"></a>Step 11: 'jar', 'war' targets</h2>
<anchor id="jar"><div class="section"><h2><a name="ajar_target"></a>'jar' target</h2>
<p>
                        This target is useful if your project is a framework for example and
                        you need to deliver a jar file. We also include a manifest file
                        in the jar, with version information. We copy the manifest to the
                        output directory in order to replace the
                        <code>@version@</code>
                        token with its value.
                    </p>
<p>
                        Example (from the Cactus build file):
                    </p>
<div class="source"><pre>
    &lt;!--
       ========================================================================
         Create the runtime jar file
       ========================================================================
    --&gt;
    &lt;!-- Preparation target for the jar target --&gt;
    &lt;target name=&quot;prepare-jar&quot; depends=&quot;compile&quot;&gt;

        &lt;mkdir dir=&quot;${out.conf.dir}&quot;/&gt;
        &lt;mkdir dir=&quot;${out.lib.dir}&quot;/&gt;

        &lt;!-- Copy the manifest in order to replace the version token filter --&gt;
        &lt;copy todir=&quot;${out.conf.dir}&quot; filtering=&quot;on&quot;&gt;
            &lt;fileset dir=&quot;${conf.dir}&quot; &gt;
                &lt;include name=&quot;manifest&quot;/&gt;
            &lt;/fileset&gt;
        &lt;/copy&gt;

    &lt;/target&gt;

    &lt;!-- Generate the jar file --&gt;
    &lt;target name=&quot;jar&quot; depends=&quot;prepare-jar&quot;&gt;

        &lt;jar jarfile=&quot;${final.jar.name}&quot; basedir=&quot;${out.classes.dir}&quot;
            manifest=&quot;${out.conf.dir}/manifest&quot;&gt;

            &lt;!-- Do not include test files in the runtime jar --&gt;
            &lt;exclude name=&quot;**/Test*.*&quot;/&gt;
            &lt;exclude name=&quot;**/test*.*&quot;/&gt;

        &lt;/jar&gt;

    &lt;/target&gt;
</pre>
</div>
</div>
<anchor id="war"><div class="section"><h2><a name="awar_target"></a>'war' target</h2>
<p>
                        This target is useful if you're building a web application.
                        We also include a manifest file in the war, with version
                        information. We copy the manifest to the output directory in order
                        to replace the <code>@version@</code> token with it's value.
                    </p>
<p>
                        Example (from the Cactus sample):
                    </p>
<div class="source"><pre>
    &lt;!--
       ========================================================================
         Create the runtime war file
       ========================================================================
    --&gt;
    &lt;!-- Preparation target for the war target --&gt;
    &lt;target name=&quot;prepare-war&quot; depends=&quot;compile&quot;&gt;

        &lt;mkdir dir=&quot;${out.conf.dir}&quot;/&gt;

        &lt;!-- Copy the manifest in order to replace the version token filter  --&gt;
        &lt;copy todir=&quot;${out.conf.dir}&quot; filtering=&quot;on&quot;&gt;
            &lt;fileset dir=&quot;${conf.dir}&quot; &gt;
                &lt;include name=&quot;manifest&quot;/&gt;
            &lt;/fileset&gt;
        &lt;/copy&gt;

    &lt;/target&gt;

    &lt;!-- Generate the war file --&gt;
    &lt;target name=&quot;war&quot; depends=&quot;prepare-war&quot;&gt;

        &lt;war warfile=&quot;${final.war.name}&quot;
             webxml=&quot;${conf.dir}/web.xml&quot;
             manifest=&quot;${out.conf.dir}/manifest&quot;&gt;

            &lt;classes dir=&quot;${out.classes.dir}&quot;&gt;
                &lt;!-- Do not include test files in the runtime jar --&gt;
                &lt;exclude name=&quot;**/Test*.*&quot;/&gt;
                &lt;exclude name=&quot;**/test*.*&quot;/&gt;

                &lt;!-- Also exclude the test cactus.properties file --&gt;
                &lt;exclude name=&quot;cactus.properties&quot;/&gt;
            &lt;/classes&gt;

            &lt;fileset dir=&quot;${web.dir}&quot;&gt;
                &lt;exclude name=&quot;test/**&quot;/&gt;
            &lt;/fileset&gt;
        &lt;/war&gt;

    &lt;/target&gt;
</pre>
</div>
</div>
</div>
<anchor id="tests"><div class="section"><h2><a name="Step_12:_tests_XXX_target"></a>Step 12: 'tests_XXX' target</h2>
<p>
                    The <code>tests_XXX</code> target is in charge of running the
                    Cactus unit tests. It must prepare the test environment for a
                    given servlet engine and package the tests, start that servlet
                    engine, run the tests by starting the JUnit runner and stop the
                    servlet engine.
                </p>
<p>
                    See the <a href="howto_ant_cactus.html">Using Cactus with
                    Ant
                </a> tutorial for details on to do this.
                </p>
</div>
</div>

      </div>
    </div>
    <div class="clear">
      <hr/>
    </div>
    <div id="footer">
      <div class="xright">&#169;  
          2001-2016
    
          The Apache Software Foundation
          
  

  
    
  
  
    
  </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
  </body>
</html>
