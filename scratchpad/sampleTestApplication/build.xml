<project name="Servlet-test-sample" default="test" basedir=".">
	<target name="init" depends="">
		<property name="src.dir" location="${basedir}/src"/>
		<property name="dest.dir" location="${basedir}/target"/>
		<property name="test.dir" location="${basedir}/test"/>
		<property name="tomcat5x.home" location="C:\Documents and Settings\Petar\My Documents\tomcat"/>
		<property name="test.reports.dir" location="${basedir}/test-reports"/>
		<path id="cactus.classpath">
			<fileset dir="./lib">
				<include name="**/*.*"/>
			</fileset>
		</path>
		<taskdef resource="cactus.tasks"
			classpathref="cactus.classpath" />
	</target>
	
	<target name="prepare" depends="init">
		<mkdir dir="${dest.dir}"/>
		<mkdir dir="${test.reports.dir}"/>
	</target>
	
	<target name="compile" depends="prepare">
		<javac srcdir="${src.dir}" destdir="${dest.dir}" classpathref="cactus.classpath"/>
		<javac srcdir="${test.dir}" destdir="${dest.dir}" classpathref="cactus.classpath"/>
	</target>
	
	<target name="package" depends="compile">
		<war warfile="${basedir}/ready.war" webxml="${basedir}/metasrc/WEB-INF/web.xml">
			<classes dir="${dest.dir}"/>
		</war>
	</target>
	
	<target name="cactify" depends="package">
		<cactifywar srcfile="${basedir}/ready.war" destfile="${basedir}/ready-cactified.war">
		  <filterredirector mapping="/test/filterRedirector"/>
		  <jspredirector mapping="/test/jspRedirector"/>
		  <servletredirector mapping="/test/servletRedirector"/>
		</cactifywar>
	</target>
	
	<target name="test" depends="prepare, compile, package, cactify">
		<cactusng warfile="${basedir}/ready-cactified.war">
		  <classpath>
		    <path refid="cactus.classpath"/>
		    <pathelement location="${dest.dir}"/>
		  </classpath>
		  <containerset>
	  		<cargo containerId="tomcat5x" home="${tomcat5x.home}">
	  		  <configuration>
	  		    <property name="cargo.servlet.port" value="8080"/>
	  		    <property name="cargo.logging" value="high"/>
	  		    <deployable type="war" file="${basedir}/ready-cactified.war"/>
	  		  </configuration>
	  		</cargo>
		  </containerset>
		  <classfileset dir="${dest.dir}" includes="**/*.class" />
		</cactusng>
	</target>
	
	<target name="clean" depends="init">
		<delete dir="${dest.dir}"/>
	</target>
</project>