<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- Generated by Apache Maven Doxia Site Renderer 1.7.1 at 2017-02-26 -->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title>Jakarta Cactus &#x2013; FilterTestCase Principles</title>
    <style type="text/css" media="all">
      @import url("../css/maven-base.css");
      @import url("../css/maven-theme.css");
      @import url("../css/site.css");
    </style>
    <link rel="stylesheet" href="../css/print.css" type="text/css" media="print" />
    <meta http-equiv="Content-Language" content="en" />
        
        </head>
  <body class="composite">
    <div id="banner">
                                      <a href="../../" id="bannerLeft">
                                                <img src="../images/logocactus.gif" alt="Cactus" />
                </a>
                              <a href="http://jakarta.apache.org/" id="bannerRight">
                                                <img src="../images/jakarta-logo.gif" alt="Apache" />
                </a>
            <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="breadcrumbs">
          
                <div class="xleft">
        <span id="publishDate">Last Published: 2017-02-26</span>
                  &nbsp;| <span id="projectVersion">Version: 1.8.2-SNAPSHOT</span>
                          |                           <a href="http://www.apache.org/" class="externalLink" title="Apache">Apache</a>
        &gt;
                          <a href="http://www.jakarta.apache.org/" class="externalLink" title="Jakarta">Jakarta</a>
        &gt;
                          <a href="../../" title="Cactus">Cactus</a>
        &gt;
    FilterTestCase Principles
              </div>
            <div class="xright">      
      </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="leftColumn">
      <div id="navcolumn">
           
                                <h5>About</h5>
                  <ul>
                  <li class="none">
                          <a href="../index.html" title="Overview">Overview</a>
            </li>
                  <li class="none">
                          <a href="../goals.html" title="Goals">Goals</a>
            </li>
                  <li class="none">
                          <a href="../features.html" title="Features">Features</a>
            </li>
                  <li class="none">
                          <a href="../news.html" title="News">News</a>
            </li>
                  <li class="none">
                          <a href="../downloads.html" title="Downloads">Downloads</a>
            </li>
                  <li class="none">
                          <a href="https://github.com/sheeper/jakarta-cactus/issues" class="externalLink" target="_blank" title="Bug Database">Bug Database</a>
            </li>
                  <li class="none">
                          <a href="../mail-lists.html" title="Mailing Lists">Mailing Lists</a>
            </li>
                  <li class="none">
                          <a href="../faq.html" title="FAQ">FAQ</a>
            </li>
                  <li class="none">
                          <a href="http://wiki.apache.org/jakarta-cactus/FrontPage" class="externalLink" target="_blank" title="Wiki">Wiki</a>
            </li>
                  <li class="none">
                          <a href="../license.html" title="License">License</a>
            </li>
          </ul>
                       <h5>Project Documentation</h5>
                  <ul>
                                                                                                                                                                                                                                                                          <li class="collapsed">
                          <a href="../project-info.html" title="Project Information">Project Information</a>
                  </li>
                                                                                                                                            <li class="collapsed">
                          <a href="../project-reports.html" title="Project Reports">Project Reports</a>
                  </li>
          </ul>
                       <h5>Documentation</h5>
                  <ul>
                  <li class="none">
                          <a href="../getting_started.html" title="Getting started">Getting started</a>
            </li>
                  <li class="none">
                          <a href="../how_it_works.html" title="How it works">How it works</a>
            </li>
                                                                                                                                                                                                                                                <li class="expanded">
                          <a href="../writing/howto_ejb.html" title="Writing tests">Writing tests</a>
                    <ul>
                      <li class="none">
                          <a href="../writing/howto_ejb_j2eeri.html" title="Howto EJB">Howto EJB</a>
            </li>
                      <li class="none">
                          <a href="../writing/howto_ejb_3.html" title="Howto EJB3">Howto EJB3</a>
            </li>
                      <li class="none">
                          <a href="../writing/howto_httpunit.html" title="Howto HTTPUnit">Howto HTTPUnit</a>
            </li>
                      <li class="none">
                          <a href="../writing/howto_htmlunit.html" title="Howto HTMLUnit">Howto HTMLUnit</a>
            </li>
                      <li class="none">
                          <a href="../writing/howto_jsp.html" title="Howto JSP">Howto JSP</a>
            </li>
                      <li class="none">
                          <a href="../writing/howto_security.html" title="Howto Security">Howto Security</a>
            </li>
                      <li class="none">
                          <a href="../writing/howto_testcase.html" title="Howto TestCase">Howto TestCase</a>
            </li>
                      <li class="none">
                          <a href="../writing/howto_testcase_jsp.html" title="Howto TestCase-JSP">Howto TestCase-JSP</a>
            </li>
                      <li class="none">
            <strong>Howto TestCase-Filter</strong>
          </li>
                      <li class="none">
                          <a href="../writing/howto_testcase_servlet.html" title="Howto TestCase-Servlet">Howto TestCase-Servlet</a>
            </li>
              </ul>
        </li>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          <li class="collapsed">
                          <a href="../integration/index.html" title="Running tests">Running tests</a>
                  </li>
                                                                                                                                                                                                                    <li class="collapsed">
                          <a href="../participating/index.html" title="Participating">Participating</a>
                  </li>
          </ul>
                       <h5>Miscellaneous</h5>
                  <ul>
                  <li class="none">
                          <a href="../cactusname.html" title="Why the name">Why the name</a>
            </li>
                  <li class="none">
                          <a href="../mock_vs_cactus.html" title="Mock vs Container">Mock vs Container</a>
            </li>
                  <li class="none">
                          <a href="http://wiki.apache.org/jakarta-cactus/TestedOn" class="externalLink" title="Tested On...">Tested On...</a>
            </li>
                                                                                                                                            <li class="collapsed">
                          <a href="../resources/index.html" title="Resources">Resources</a>
                  </li>
          </ul>
                       <h5>Translations</h5>
                  <ul>
                  <li class="none">
                          <a href="http://www.ressources-java.net/cactus" class="externalLink" target="_blank" title="French">French</a>
            </li>
                  <li class="none">
                          <a href="http://jakarta.apache-korea.org/cactus/index.html" class="externalLink" target="_blank" title="Korean">Korean</a>
            </li>
                  <li class="none">
                          <a href="http://www.jajakarta.org/cactus/" class="externalLink" target="_blank" title="Japanese">Japanese</a>
            </li>
          </ul>
                       <h5>See also</h5>
                  <ul>
                  <li class="none">
                          <a href="http://www.apachebookstore.com/" class="externalLink" target="_blank" title="Apache Bookstore">Apache Bookstore</a>
            </li>
                  <li class="none">
                          <a href="http://www.planetapache.org/" class="externalLink" target="_blank" title="Planet Apache">Planet Apache</a>
            </li>
                  <li class="none">
                          <a href="http://apache.org/foundation/thanks.html" class="externalLink" target="_blank" title="Apache Sponsors">Apache Sponsors</a>
            </li>
          </ul>
                                                                                                                                     <a href="../../" title="Jakarta Cactus" class="poweredBy">
        <img class="poweredBy"  alt="Jakarta Cactus" src="../images/cactusbanner.gif"     />
      </a>
                     
            </div>
    </div>
    <div id="bodyColumn">
      <div id="contentBox">
        

    

        <div class="section">
<h2><a name="When_to_use"></a>When to use?</h2>

            
<p>
                Your test case class should extend
                <tt>FilterTestCase</tt>
                whenever you are unit testing:
            </p>
            
<ul>
                
<li>
                    Servlet Filters,
                </li>
                
<li>
                    Any java code that uses Filter API objects
                    (<tt>FilterConfig</tt>, ...)
                </li>
            </ul>

            
<blockquote class="info infomark">
                <b>As filters only exist in Servlet API 2.3, you must use the
                    Cactus version for Servlet API 2.3 if you wish to write tests for
                    them.
                </b>
            </blockquote>
            
<blockquote class="info infomark">
                <b>Filter unit testing is only available in Cactus 1.2 and
                    above.
                </b>
            </blockquote>

        </div>

        
<div class="section">
<h2><a name="Provided_Implicit_Objects"></a>Provided Implicit Objects</h2>

            
<p>
                Cactus automatically initializes the implicit objects for you and
                they are made available to your <tt>setUp()</tt>,
                <tt>testXXX()</tt>
                and <tt>tearDown()</tt> methods as
                instance variables of the <tt>FilterTestCase</tt> class (and thus
                as instance variables of your test case class as it extends
                <tt>FilterTestCase</tt>).
            </p>
            
<blockquote class="info infomark">
                You may ask yourself how Cactus initializes these objects. The
                mechanism is described in the <a href="../how_it_works.html">How it
                works
            </a> guide.
            </blockquote>

            
<p>
                The provided implicit objects are:
            </p>

            <a name="filter_request"></a>
<div class="section" id="filter_request">
<h3><a name="request"></a>request</h3>

                
<p>
                    See
                    <tt>ServletTestCase</tt>
                    <tt>
                        <a href="howto_testcase_servlet.html#servlet_request">request
                        </a>
                    </tt>
                    implicit object for documentation.
                </p>

            </div>

            <a name="filter_response"></a>
<div class="section" id="filter_response">
<h3><a name="response"></a>response</h3>

                
<p>
                    See
                    <tt>ServletTestCase</tt>
                    <tt>
                        <a href="howto_testcase_servlet.html#servlet_response">response
                        </a>
                    </tt>
                    implicit object for documentation.
                </p>

            </div>

            <a name="filter_config"></a>
<div class="section" id="filter_config">
<h3><a name="config"></a>config</h3>

                
<table border="0" class="bodyTable">
                    
<tr class="a">
                        
<td>
                            Instance variable name
                        </td>
                        
<td>
                            <b>
                                <tt>config</tt>
                            </b>
                        </td>
                    </tr>
                    
<tr class="b">
                        
<td>
                            Class name
                        </td>
                        
<td>
                            <tt>org.apache.cactus.server.FilterConfigWrapper
                            </tt>, which inherits from
                            <tt>javax.servlet.FilterConfig</tt>
                        </td>
                    </tr>
                </table>

                
<p>
                    Cactus wraps the original Filter Config for two reasons:
                </p>
                
<ul>
                    
<li>
                        In order to provide additional methods. For example, it is
                        possible to initialise filter parameters without setting them in
                        <tt>web.xml</tt>, etc...,
                    </li>
                    
<li>
                        So that it can return a wrapped Servlet Context instead of the
                        original one. This is because the Servlet Context is used
                        to perform forwards and includes and we need to pass to these
                        methods the original request and response. As we have wrapped
                        the request, we need to wrap the Servlet Context to pass the
                        original request (and not the wrapped one).
                    </li>
                </ul>
                
<p>
                    The <tt>config</tt> implicit object will contain all
                    initialisation parameters defined in
                    <tt>web.xml</tt>
                    under the Filter Redirector filter definition.
                </p>
                
<p>
                    See the javadoc for the
                    <tt>org.apache.cactus.server.FilterConfigWrapper</tt>
                    class for all details. You should also look at the
                    samples provided in the Cactus distribution.
                </p>

                
<div class="section">
<h4><a name="Additional_methods"></a>Additional methods</h4>

                    
<p>
                        Additional methods provided:
                    </p>
                    
<ul>
                        
<li>
                            <tt>setInitParameter()</tt>: sets an initialisation
                            parameter (as if it has been defined in the
                            <tt>web.xml</tt>
                            file),
                        </li>
                        
<li>
                            <tt>setFilterName()</tt>: sets the Filter name that will be
                            returned by <tt>getFilterName()</tt> (if not set, the
                            Cactus Filter redirector name will be returned).
                        </li>
                    </ul>


            </div></div>

            <a name="filter_filterChain"></a>
<div class="section" id="filter_filterChain">
<h3><a name="filterChain"></a>filterChain</h3>

                
<table border="0" class="bodyTable">
                    
<tr class="a">
                        
<td>
                            Instance variable name
                        </td>
                        
<td>
                            <b>
                                <tt>filterChain</tt>
                            </b>
                        </td>
                    </tr>
                    
<tr class="b">
                        
<td>
                            Class name
                        </td>
                        
<td>
                            <tt>javax.servlet.FilterChain</tt>
                        </td>
                    </tr>
                </table>

                
<blockquote class="info infomark">
                    Cactus does not wrap the filter chain.
                </blockquote>

            </div>

        </div>

        
<div class="section">
<h2><a name="Tips_and_Tricks"></a>Tips and Tricks</h2>

            
<div class="section">
<h3><a name="Simulating_the_next_fitler_in_chain"></a>Simulating the next fitler in chain</h3>

                
<p>
                    As you are performing unit testing of your filter, you may wish
                    to simulate the next filter in the filter chain so that you can
                    decide, as part of your unit test, what this other filter returns
                    to your filter under test. Here is how you could do that:
                </p>

                
<div class="source">
<pre>
public void testDoFilterOK() throws ServletException, IOException
{
    SampleFilter filter = new SampleFilter();
    filter.init(config);
[...]

    FilterChain mockFilterChain = new FilterChain() {
        public void doFilter(ServletRequest theRequest,
            ServletResponse theResponse) throws IOException, ServletException
        {
            PrintWriter writer = theResponse.getWriter();
            writer.print(&quot;&lt;p&gt;some content&lt;/p&gt;&quot;);
            writer.close();
        }
        public void init(FilterConfig theConfig)
        {
        }
        public void destroy()
        {
        }
    };

    filter.doFilter(request, response, mockFilterChain);
[...]
}
</pre></div>

                
<p>
                    See the samples provided as part of the Cactus distribution.
                </p>

            </div>

        </div>

        
<div class="section">
<h2><a name="Sample"></a>Sample</h2>

            
<p>
                This is a very basic sample intended to give you a flavour of Filter
                unit testing. Check the distribution samples for extensive
                examples. The filter we are testing here simply adds a header and
                a footer to the response. The header and footer texts are
                defined as a parameter defined in <tt>web.xml</tt>.
            </p>

            
<div class="source">
<pre>
public void testXXX() throws ServletException, IOException
{
    SampleFilter filter = new SampleFilter();
    config.setInitParameter(&quot;header&quot;, &quot;&lt;h1&gt;header&lt;/h1&gt;&quot;);
    config.setInitParameter(&quot;footer&quot;, &quot;&lt;h1&gt;footer&lt;/h1&gt;&quot;);
    filter.init(config);

    FilterChain mockFilterChain = new FilterChain() {
        public void doFilter(ServletRequest theRequest,
            ServletResponse theResponse) throws IOException, ServletException
        {
            PrintWriter writer = theResponse.getWriter();
            writer.print(&quot;&lt;p&gt;some content&lt;/p&gt;&quot;);
            writer.close();
        }
        public void init(FilterConfig theConfig)
        {
        }
        public void destroy()
        {
        }
    };

    filter.doFilter(request, response, mockFilterChain);
}

public void endXXX(WebResponse theResponse)
{
    assertEquals(&quot;&lt;h1&gt;header&lt;/h1&gt;&lt;p&gt;some content&lt;/p&gt;&lt;h1&gt;footer&lt;/h1&gt;&quot;,
        theResponse.getText());
}
</pre></div>

        </div>

    

      </div>
    </div>
    <div class="clear">
      <hr/>
    </div>
    <div id="footer">
      <div class="xright">
              Copyright &#169;                    2001&#x2013;2017
                        <a href="http://www.apache.org/">The Apache Software Foundation</a>.
            All rights reserved.    
                  </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
  </body>
</html>
